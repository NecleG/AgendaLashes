<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lash Design Studio - Agenda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, addDoc, deleteDoc, updateDoc, onSnapshot, query, where, orderBy } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
        
        console.log('Carregando Firebase...');
        
        // Suas configurações do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBUF8USZ4eHJPqM6SBiHDGhOmvYpZmVSnk",
            authDomain: "agenda-lashes-f3766.firebaseapp.com",
            projectId: "agenda-lashes-f3766",
            storageBucket: "agenda-lashes-f3766.firebasestorage.app",
            messagingSenderId: "321642421475",
            appId: "1:321642421475:web:cea7c933f29ff5bea1b9d6",
            measurementId: "G-62GWTEQG3W"
        };
        
        try {
            // Inicializar Firebase
            console.log('Inicializando Firebase...');
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            const googleProvider = new GoogleAuthProvider();
            
            console.log('Firebase inicializado com sucesso!');
            console.log('Auth:', auth);
            console.log('DB:', db);
            
            // Disponibilizar globalmente
            window.firebaseAuth = auth;
            window.firebaseDB = db;
            window.firebaseUtils = {
                signInWithEmailAndPassword,
                createUserWithEmailAndPassword,
                signInWithPopup,
                GoogleAuthProvider: googleProvider,
                signOut,
                onAuthStateChanged,
                collection,
                doc,
                setDoc,
                getDoc,
                getDocs,
                addDoc,
                deleteDoc,
                updateDoc,
                onSnapshot,
                query,
                where,
                orderBy
            };
            
            // Sinalizar que Firebase está pronto
            window.firebaseReady = true;
            console.log('Firebase disponível globalmente!');
            
        } catch (error) {
            console.error('Erro ao inicializar Firebase:', error);
            window.firebaseError = error;
        }
    </script>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .custom-brown { background-color: #4E1E14; }
        .custom-brown-light { background-color: #6B2A1F; }
        .text-custom-brown { color: #4E1E14; }
        .border-custom-brown { border-color: #4E1E14; }
        
        .gold-gradient {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }
        
        .gold-text {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        .slide-down {
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .hover-scale {
            transition: all 0.3s ease;
        }
        
        .hover-scale:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.2);
        }
        
        .calendar-day {
            transition: all 0.2s ease;
            position: relative;
        }
        
        .calendar-day:hover {
            background-color: #FFD700;
            color: #000;
            transform: scale(1.05);
        }
        
        .has-appointment {
            background: linear-gradient(135deg, #4E1E14, #6B2A1F);
            color: white;
        }
        
        .has-appointment::after {
            content: '';
            position: absolute;
            top: 4px;
            right: 4px;
            width: 8px;
            height: 8px;
            background: #FFD700;
            border-radius: 50%;
        }
        
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .card-hover {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 35px rgba(255, 215, 0, 0.3);
            border-color: #FFD700;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #FFD700;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: #FFD700;
        }
        
        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            border-color: #FFD700;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .input-field option {
            background: #1a1a1a;
            color: #ffffff;
            padding: 8px;
        }
        
        .input-field option:hover {
            background: #333333;
        }
        
        .notification-alert {
            animation: pulse 2s infinite;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen">
    <!-- Tela de Login -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-md shadow-2xl">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold gold-text mb-2">Lash Design Studio</h1>
                <p class="text-yellow-200">Sistema de Agendamento</p>
            </div>
            
            <!-- Formulário de Login -->
            <div id="login-form" class="space-y-6">
                <div>
                    <label class="block text-yellow-300 font-semibold mb-3">
                        <i class="fas fa-envelope mr-2"></i>Email
                    </label>
                    <input type="email" id="login-email" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="seu@email.com">
                </div>
                
                <div>
                    <label class="block text-yellow-300 font-semibold mb-3">
                        <i class="fas fa-lock mr-2"></i>Senha
                    </label>
                    <input type="password" id="login-password" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="••••••••">
                </div>
                
                <button onclick="loginWithEmail()" class="w-full btn-primary py-3 rounded-xl font-bold">
                    <i class="fas fa-sign-in-alt mr-2"></i>Entrar
                </button>
                
                <div class="text-center">
                    <span class="text-gray-400">ou</span>
                </div>
                
                <button onclick="loginWithGoogle()" class="w-full btn-secondary py-3 rounded-xl font-bold flex items-center justify-center">
                    <i class="fab fa-google mr-2"></i>Entrar com Google
                </button>
                
                <div class="text-center">
                    <button onclick="showRegister()" class="text-yellow-400 hover:text-yellow-300 underline">
                        Não tem conta? Cadastre-se
                    </button>
                </div>
            </div>
            
            <!-- Formulário de Cadastro -->
            <div id="register-form" class="space-y-6 hidden">
                <div>
                    <label class="block text-yellow-300 font-semibold mb-3">
                        <i class="fas fa-user mr-2"></i>Nome Completo
                    </label>
                    <input type="text" id="register-name" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="Seu nome completo">
                </div>
                
                <div>
                    <label class="block text-yellow-300 font-semibold mb-3">
                        <i class="fas fa-envelope mr-2"></i>Email
                    </label>
                    <input type="email" id="register-email" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="seu@email.com">
                </div>
                
                <div>
                    <label class="block text-yellow-300 font-semibold mb-3">
                        <i class="fas fa-lock mr-2"></i>Senha
                    </label>
                    <input type="password" id="register-password" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="••••••••">
                </div>
                
                <div>
                    <label class="block text-yellow-300 font-semibold mb-3">
                        <i class="fas fa-lock mr-2"></i>Confirmar Senha
                    </label>
                    <input type="password" id="register-confirm" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="••••••••">
                </div>
                
                <button onclick="registerWithEmail()" class="w-full btn-primary py-3 rounded-xl font-bold">
                    <i class="fas fa-user-plus mr-2"></i>Criar Conta
                </button>
                
                <div class="text-center">
                    <span class="text-gray-400">ou</span>
                </div>
                
                <button onclick="loginWithGoogle()" class="w-full btn-secondary py-3 rounded-xl font-bold flex items-center justify-center">
                    <i class="fab fa-google mr-2"></i>Cadastrar com Google
                </button>
                
                <div class="text-center">
                    <button onclick="showLogin()" class="text-yellow-400 hover:text-yellow-300 underline">
                        Já tem conta? Faça login
                    </button>
                </div>
            </div>
            
            <!-- Loading -->
            <div id="auth-loading" class="text-center py-8 hidden">
                <i class="fas fa-spinner fa-spin text-3xl gold-text"></i>
                <p class="text-yellow-300 mt-4">Carregando...</p>
            </div>
        </div>
    </div>

    <!-- App Principal -->
    <div id="main-app" class="hidden">
        <!-- Header -->
        <header class="custom-brown shadow-2xl relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-yellow-500/10 to-transparent"></div>
            <div class="container mx-auto px-4 py-6 relative">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-2xl md:text-4xl font-bold gold-text">
                            Lash Design Studio
                        </h1>
                        <p class="text-yellow-200 mt-1 text-sm md:text-lg font-light">Sistema de Agendamento Profissional</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right hidden md:block">
                            <p class="text-yellow-300 font-semibold" id="user-name">Usuário</p>
                            <p class="text-yellow-200 text-sm" id="user-email">email@exemplo.com</p>
                        </div>
                        <button onclick="logout()" class="btn-secondary px-4 py-2 rounded-xl font-bold">
                            <i class="fas fa-sign-out-alt mr-2"></i>Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="glass-effect border-b border-yellow-500/30">
            <div class="container mx-auto px-4">
                <div class="flex flex-wrap justify-center gap-2 py-4 md:py-6">
                    <button onclick="showTab('agenda')" class="nav-btn btn-primary px-4 md:px-8 py-2 md:py-3 rounded-xl font-semibold text-sm md:text-base">
                        <i class="fas fa-calendar-alt mr-1 md:mr-2"></i><span class="hidden sm:inline">Agenda</span>
                    </button>
                    <button onclick="showTab('clientes')" class="nav-btn btn-secondary px-4 md:px-8 py-2 md:py-3 rounded-xl font-semibold text-sm md:text-base">
                        <i class="fas fa-users mr-1 md:mr-2"></i><span class="hidden sm:inline">Clientes</span>
                    </button>
                    <button onclick="showTab('procedimentos')" class="nav-btn btn-secondary px-4 md:px-8 py-2 md:py-3 rounded-xl font-semibold text-sm md:text-base">
                        <i class="fas fa-spa mr-1 md:mr-2"></i><span class="hidden sm:inline">Procedimentos</span>
                    </button>
                    <button onclick="showTab('calendario')" class="nav-btn btn-secondary px-4 md:px-8 py-2 md:py-3 rounded-xl font-semibold text-sm md:text-base">
                        <i class="fas fa-calendar mr-1 md:mr-2"></i><span class="hidden sm:inline">Calendário</span>
                    </button>
                </div>
            </div>
        </nav>

    <!-- Área de Notificações -->
    <div id="notification-area" class="fixed top-20 right-4 z-50 space-y-4 max-w-md">
        <!-- Notificações de agendamento aparecerão aqui -->
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        
        <!-- Agenda Tab -->
        <div id="agenda-tab" class="tab-content fade-in">
            <div class="glass-effect rounded-2xl p-8 shadow-2xl">
                <div class="flex items-center mb-8">
                    <i class="fas fa-calendar-plus text-3xl gold-text mr-4"></i>
                    <h2 class="text-3xl font-bold gold-text">Novo Agendamento</h2>
                </div>
                
                <form id="agendamento-form" class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                <i class="fas fa-user mr-2"></i>Cliente *
                            </label>
                            <select id="cliente-select" required class="w-full input-field rounded-xl px-4 py-4 text-white">
                                <option value="">Selecione um cliente</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                <i class="fas fa-spa mr-2"></i>Procedimento *
                            </label>
                            <select id="procedimento-select" required class="w-full input-field rounded-xl px-4 py-4 text-white">
                                <option value="">Selecione um procedimento</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                <i class="fas fa-dollar-sign mr-2"></i>Valor
                            </label>
                            <input type="text" id="valor-display" readonly class="w-full input-field rounded-xl px-4 py-4 text-yellow-400 font-bold">
                        </div>
                        
                        <div>
                            <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                <i class="fas fa-credit-card mr-2"></i>Forma de Pagamento *
                            </label>
                            <select id="pagamento-select" required class="w-full input-field rounded-xl px-4 py-4 text-white">
                                <option value="">Selecione</option>
                                <option value="dinheiro">Dinheiro</option>
                                <option value="cartao">Cartão</option>
                                <option value="pix">PIX</option>
                                <option value="transferencia">Transferência</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                <i class="fas fa-calendar mr-2"></i>Data *
                            </label>
                            <input type="date" id="data-agendamento" required class="w-full input-field rounded-xl px-4 py-4 text-white">
                        </div>
                        
                        <div>
                            <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                <i class="fas fa-clock mr-2"></i>Horário *
                            </label>
                            <input type="time" id="hora-agendamento" required class="w-full input-field rounded-xl px-4 py-4 text-white">
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full btn-primary py-4 rounded-xl text-lg font-bold">
                        <i class="fas fa-plus mr-2"></i>Agendar Procedimento
                    </button>
                </form>
                
                <!-- Lista de Agendamentos -->
                <div class="mt-12">
                    <div class="flex items-center mb-6">
                        <i class="fas fa-list text-2xl gold-text mr-3"></i>
                        <h3 class="text-2xl font-bold gold-text">Agendamentos de Hoje</h3>
                    </div>
                    
                    <!-- Filtro de Pesquisa Agendamentos -->
                    <div class="mb-6">
                        <div class="relative">
                            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-yellow-400"></i>
                            <input type="text" id="filtro-agendamentos" placeholder="Pesquisar agendamento..." class="w-full input-field rounded-xl pl-12 pr-4 py-3 text-white">
                        </div>
                    </div>
                    
                    <div id="agendamentos-hoje" class="space-y-4">
                        <!-- Agendamentos serão inseridos aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Clientes Tab -->
        <div id="clientes-tab" class="tab-content hidden">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Cadastro de Cliente -->
                <div class="glass-effect rounded-2xl p-8 shadow-2xl slide-up">
                    <div class="flex items-center mb-8">
                        <i class="fas fa-user-plus text-3xl gold-text mr-4"></i>
                        <h2 class="text-3xl font-bold gold-text" id="cliente-form-title">Cadastrar Cliente</h2>
                    </div>
                    
                    <form id="cliente-form" class="space-y-6">
                        <input type="hidden" id="cliente-id">
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                    <i class="fas fa-user mr-2"></i>Nome Completo *
                                </label>
                                <input type="text" id="cliente-nome" required class="w-full input-field rounded-xl px-4 py-3 text-white">
                            </div>
                            
                            <div>
                                <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                    <i class="fas fa-birthday-cake mr-2"></i>Data de Nascimento *
                                </label>
                                <input type="date" id="cliente-nascimento" required class="w-full input-field rounded-xl px-4 py-3 text-white">
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                    <i class="fas fa-map-marker-alt mr-2"></i>Endereço
                                </label>
                                <input type="text" id="cliente-endereco" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="Rua, número">
                            </div>
                            
                            <div>
                                <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                    <i class="fas fa-building mr-2"></i>Bairro
                                </label>
                                <input type="text" id="cliente-bairro" class="w-full input-field rounded-xl px-4 py-3 text-white">
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                    <i class="fas fa-city mr-2"></i>Cidade *
                                </label>
                                <input type="text" id="cliente-cidade" required class="w-full input-field rounded-xl px-4 py-3 text-white">
                            </div>
                            
                            <div>
                                <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                    <i class="fas fa-phone mr-2"></i>Telefone *
                                </label>
                                <input type="tel" id="cliente-telefone" required class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="(11) 99999-9999">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                <i class="fas fa-user-friends mr-2"></i>Se for menor de idade (Responsável)
                            </label>
                            <input type="text" id="cliente-responsavel" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="Nome do responsável">
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                    <i class="fas fa-id-card mr-2"></i>RG
                                </label>
                                <input type="text" id="cliente-rg" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="00.000.000-0">
                            </div>
                            
                            <div>
                                <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                    <i class="fas fa-id-badge mr-2"></i>CPF
                                </label>
                                <input type="text" id="cliente-cpf" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="000.000.000-00">
                            </div>
                        </div>
                        
                        <!-- Ficha Anamnese -->
                        <div class="border-t border-yellow-500/30 pt-6 mt-8">
                            <div class="flex items-center mb-6">
                                <i class="fas fa-clipboard-list text-2xl gold-text mr-3"></i>
                                <h3 class="text-xl font-bold gold-text">Ficha Anamnese</h3>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-yellow-300 mb-3">Possui alergia a esmalte/cosméticos/cianoacrilato?</label>
                                    <select id="alergia" class="w-full input-field rounded-xl px-4 py-3 text-white mb-3">
                                        <option value="">Selecione</option>
                                        <option value="sim">Sim</option>
                                        <option value="nao">Não</option>
                                    </select>
                                    <input type="text" id="alergia-especificar" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="Se sim, especifique qual alergia...">
                                </div>
                                
                                <div>
                                    <label class="block text-yellow-300 mb-3">É gestante?</label>
                                    <select id="gestante" class="w-full input-field rounded-xl px-4 py-3 text-white">
                                        <option value="">Selecione</option>
                                        <option value="sim">Sim</option>
                                        <option value="nao">Não</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-yellow-300 mb-3">Alguma doença ocular?</label>
                                    <select id="doenca-ocular" class="w-full input-field rounded-xl px-4 py-3 text-white mb-3">
                                        <option value="">Selecione</option>
                                        <option value="sim">Sim</option>
                                        <option value="nao">Não</option>
                                    </select>
                                    <input type="text" id="doenca-especificar" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="Se sim, especifique qual doença...">
                                </div>
                            </div>
                            
                            <div class="mt-6">
                                <label class="block text-yellow-300 mb-3">Observações Gerais</label>
                                <textarea id="observacoes" rows="3" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="Informações adicionais..."></textarea>
                            </div>
                        </div>
                        
                        <div class="flex space-x-4">
                            <button type="submit" class="flex-1 btn-primary py-4 rounded-xl text-lg font-bold">
                                <i class="fas fa-save mr-2"></i><span id="cliente-btn-text">Cadastrar Cliente</span>
                            </button>
                            <button type="button" id="cancelar-edicao" class="btn-secondary px-6 py-4 rounded-xl font-bold hidden">
                                <i class="fas fa-times mr-2"></i>Cancelar
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Lista de Clientes -->
                <div class="glass-effect rounded-2xl p-8 shadow-2xl slide-up">
                    <div class="flex items-center mb-8">
                        <i class="fas fa-users text-3xl gold-text mr-4"></i>
                        <h2 class="text-3xl font-bold gold-text">Clientes Cadastrados</h2>
                    </div>
                    
                    <!-- Filtro de Pesquisa -->
                    <div class="mb-6">
                        <div class="relative">
                            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-yellow-400"></i>
                            <input type="text" id="filtro-clientes" placeholder="Pesquisar cliente..." class="w-full input-field rounded-xl pl-12 pr-4 py-3 text-white">
                        </div>
                    </div>
                    
                    <div id="lista-clientes" class="space-y-4 max-h-96 overflow-y-auto">
                        <!-- Clientes serão inseridos aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Procedimentos Tab -->
        <div id="procedimentos-tab" class="tab-content hidden">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Cadastro de Procedimento -->
                <div class="glass-effect rounded-2xl p-8 shadow-2xl slide-up">
                    <div class="flex items-center mb-8">
                        <i class="fas fa-spa text-3xl gold-text mr-4"></i>
                        <h2 class="text-3xl font-bold gold-text">Cadastrar Procedimento</h2>
                    </div>
                    
                    <form id="procedimento-form" class="space-y-6">
                        <div>
                            <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                <i class="fas fa-tag mr-2"></i>Nome do Procedimento *
                            </label>
                            <input type="text" id="procedimento-nome" required class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="Ex: Extensão Clássica">
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                    <i class="fas fa-dollar-sign mr-2"></i>Valor (R$) *
                                </label>
                                <input type="number" id="procedimento-valor" required step="0.01" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="0.00">
                            </div>
                            
                            <div>
                                <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                    <i class="fas fa-clock mr-2"></i>Duração (minutos)
                                </label>
                                <input type="number" id="procedimento-duracao" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="120">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                                <i class="fas fa-align-left mr-2"></i>Descrição
                            </label>
                            <textarea id="procedimento-descricao" rows="4" class="w-full input-field rounded-xl px-4 py-3 text-white" placeholder="Descrição do procedimento..."></textarea>
                        </div>
                        
                        <button type="submit" class="w-full btn-primary py-4 rounded-xl text-lg font-bold">
                            <i class="fas fa-plus mr-2"></i>Cadastrar Procedimento
                        </button>
                    </form>
                </div>
                
                <!-- Lista de Procedimentos -->
                <div class="glass-effect rounded-2xl p-8 shadow-2xl slide-up">
                    <div class="flex items-center mb-8">
                        <i class="fas fa-list-alt text-3xl gold-text mr-4"></i>
                        <h2 class="text-3xl font-bold gold-text">Procedimentos Cadastrados</h2>
                    </div>
                    <div id="lista-procedimentos" class="space-y-4 max-h-96 overflow-y-auto">
                        <!-- Procedimentos serão inseridos aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendário Tab -->
        <div id="calendario-tab" class="tab-content hidden">
            <div class="glass-effect rounded-2xl p-8 shadow-2xl slide-up">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8">
                    <div class="flex items-center">
                        <i class="fas fa-calendar-alt text-3xl gold-text mr-4"></i>
                        <h2 class="text-3xl font-bold gold-text">Calendário de Agendamentos</h2>
                    </div>
                    <div class="flex items-center space-x-4 mt-4 md:mt-0">
                        <button onclick="previousMonth()" class="btn-primary px-6 py-3 rounded-xl font-bold">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span id="current-month" class="text-xl font-bold text-yellow-300 min-w-48 text-center"></span>
                        <button onclick="nextMonth()" class="btn-primary px-6 py-3 rounded-xl font-bold">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-7 gap-3 mb-6">
                    <div class="text-center font-bold text-yellow-400 py-3 text-lg">Dom</div>
                    <div class="text-center font-bold text-yellow-400 py-3 text-lg">Seg</div>
                    <div class="text-center font-bold text-yellow-400 py-3 text-lg">Ter</div>
                    <div class="text-center font-bold text-yellow-400 py-3 text-lg">Qua</div>
                    <div class="text-center font-bold text-yellow-400 py-3 text-lg">Qui</div>
                    <div class="text-center font-bold text-yellow-400 py-3 text-lg">Sex</div>
                    <div class="text-center font-bold text-yellow-400 py-3 text-lg">Sáb</div>
                </div>
                
                <div id="calendar-grid" class="grid grid-cols-7 gap-3 mb-8">
                    <!-- Dias do calendário serão inseridos aqui -->
                </div>
                
                <div class="border-t border-yellow-500/30 pt-8">
                    <div class="flex items-center mb-6">
                        <i class="fas fa-list text-2xl gold-text mr-3"></i>
                        <h3 class="text-2xl font-bold gold-text">Agendamentos do Dia Selecionado</h3>
                    </div>
                    <div id="agendamentos-dia" class="space-y-4">
                        <p class="text-gray-400 text-center py-8">Selecione um dia no calendário para ver os agendamentos</p>
                    </div>
                </div>
            </div>
        </div>
        </main>
    </div>

    <!-- Modal de Edição de Agendamento -->
    <div id="modal-agendamento" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 max-w-2xl w-full max-h-90vh overflow-y-auto slide-down">
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center">
                    <i class="fas fa-edit text-3xl gold-text mr-4"></i>
                    <h2 class="text-3xl font-bold gold-text">Editar Agendamento</h2>
                </div>
                <button onclick="closeModalAgendamento()" class="text-gray-400 hover:text-white text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="edit-agendamento-form" class="space-y-6">
                <input type="hidden" id="edit-agendamento-id">
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                            <i class="fas fa-user mr-2"></i>Cliente *
                        </label>
                        <select id="edit-cliente-select" required class="w-full input-field rounded-xl px-4 py-4 text-white">
                            <option value="">Selecione um cliente</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                            <i class="fas fa-spa mr-2"></i>Procedimento *
                        </label>
                        <select id="edit-procedimento-select" required class="w-full input-field rounded-xl px-4 py-4 text-white">
                            <option value="">Selecione um procedimento</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                            <i class="fas fa-dollar-sign mr-2"></i>Valor
                        </label>
                        <input type="text" id="edit-valor-display" readonly class="w-full input-field rounded-xl px-4 py-4 text-yellow-400 font-bold">
                    </div>
                    
                    <div>
                        <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                            <i class="fas fa-credit-card mr-2"></i>Forma de Pagamento *
                        </label>
                        <select id="edit-pagamento-select" required class="w-full input-field rounded-xl px-4 py-4 text-white">
                            <option value="">Selecione</option>
                            <option value="dinheiro">Dinheiro</option>
                            <option value="cartao">Cartão</option>
                            <option value="pix">PIX</option>
                            <option value="transferencia">Transferência</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                            <i class="fas fa-calendar mr-2"></i>Data *
                        </label>
                        <input type="date" id="edit-data-agendamento" required class="w-full input-field rounded-xl px-4 py-4 text-white">
                    </div>
                    
                    <div>
                        <label class="block text-yellow-300 font-semibold mb-3 flex items-center">
                            <i class="fas fa-clock mr-2"></i>Horário *
                        </label>
                        <input type="time" id="edit-hora-agendamento" required class="w-full input-field rounded-xl px-4 py-4 text-white">
                    </div>
                </div>
                
                <div class="flex space-x-4">
                    <button type="submit" class="flex-1 btn-primary py-4 rounded-xl text-lg font-bold">
                        <i class="fas fa-save mr-2"></i>Salvar Alterações
                    </button>
                    <button type="button" onclick="closeModalAgendamento()" class="btn-secondary px-8 py-4 rounded-xl font-bold">
                        <i class="fas fa-times mr-2"></i>Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Dados em memória
        let clientes = [];
        let procedimentos = [];
        let agendamentos = [];
        let currentDate = new Date();
        let selectedDate = null;
        let currentUser = null;

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Função para verificar se Firebase está pronto
            function checkFirebaseReady() {
                if (window.firebaseReady && window.firebaseAuth && window.firebaseDB && window.firebaseUtils) {
                    console.log('Firebase está pronto! Inicializando autenticação...');
                    initializeAuth();
                } else if (window.firebaseError) {
                    console.error('Erro no Firebase:', window.firebaseError);
                    showNotification('Erro ao conectar com Firebase!', 'error');
                } else {
                    console.log('Aguardando Firebase carregar...');
                    setTimeout(checkFirebaseReady, 500);
                }
            }
            
            // Iniciar verificação
            checkFirebaseReady();
        });

        // Sistema de Autenticação Firebase
        function initializeAuth() {
            const { onAuthStateChanged } = window.firebaseUtils;
            
            onAuthStateChanged(window.firebaseAuth, (user) => {
                if (user) {
                    currentUser = user;
                    showMainApp(user);
                    setupFirebaseListeners();
                    loadFirebaseData();
                } else {
                    showLoginScreen();
                }
            });
        }

        function showLoginScreen() {
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }

        function showMainApp(user) {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            // Atualizar informações do usuário
            document.getElementById('user-name').textContent = user.displayName || 'Usuário';
            document.getElementById('user-email').textContent = user.email;
            
            // Inicializar app
            updateCalendar();
            updateAgendamentosHoje();
            checkUpcomingAppointments();
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('data-agendamento').min = today;
            
            // Eventos dos filtros
            document.getElementById('filtro-clientes').addEventListener('input', function() {
                updateClientesList(this.value);
            });
            
            document.getElementById('filtro-agendamentos').addEventListener('input', function() {
                updateAgendamentosHoje(this.value);
            });
            
            // Verificar agendamentos a cada minuto
            setInterval(checkUpcomingAppointments, 60000);
        }

        // Funções de Login
        function showLogin() {
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('register-form').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
        }

        function showAuthLoading() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById('auth-loading').classList.remove('hidden');
        }

        function hideAuthLoading() {
            document.getElementById('auth-loading').classList.add('hidden');
        }

        async function loginWithEmail() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showNotification('Preencha todos os campos!', 'error');
                return;
            }
            
            showAuthLoading();
            
            try {
                const { signInWithEmailAndPassword } = window.firebaseUtils;
                await signInWithEmailAndPassword(window.firebaseAuth, email, password);
                showNotification('Login realizado com sucesso!', 'success');
            } catch (error) {
                hideAuthLoading();
                showLogin();
                console.error('Erro no login:', error);
                showNotification('Erro no login: ' + getErrorMessage(error.code), 'error');
            }
        }

        async function registerWithEmail() {
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm').value;
            
            if (!name || !email || !password || !confirmPassword) {
                showNotification('Preencha todos os campos!', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('As senhas não coincidem!', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('A senha deve ter pelo menos 6 caracteres!', 'error');
                return;
            }
            
            showAuthLoading();
            
            try {
                const { createUserWithEmailAndPassword } = window.firebaseUtils;
                const { doc, setDoc } = window.firebaseUtils;
                
                const userCredential = await createUserWithEmailAndPassword(window.firebaseAuth, email, password);
                
                // Salvar dados do usuário
                await setDoc(doc(window.firebaseDB, 'users', userCredential.user.uid), {
                    name: name,
                    email: email,
                    createdAt: new Date().toISOString()
                });
                
                showNotification('Conta criada com sucesso!', 'success');
            } catch (error) {
                hideAuthLoading();
                showRegister();
                console.error('Erro no cadastro:', error);
                showNotification('Erro no cadastro: ' + getErrorMessage(error.code), 'error');
            }
        }

        async function loginWithGoogle() {
            showAuthLoading();
            
            try {
                const { signInWithPopup } = window.firebaseUtils;
                const { doc, setDoc, getDoc } = window.firebaseUtils;
                
                const result = await signInWithPopup(window.firebaseAuth, window.firebaseUtils.GoogleAuthProvider);
                
                // Verificar se é primeiro login e salvar dados
                const userRef = doc(window.firebaseDB, 'users', result.user.uid);
                const snapshot = await getDoc(userRef);
                
                if (!snapshot.exists()) {
                    await setDoc(userRef, {
                        name: result.user.displayName,
                        email: result.user.email,
                        createdAt: new Date().toISOString()
                    });
                }
                
                showNotification('Login realizado com sucesso!', 'success');
            } catch (error) {
                hideAuthLoading();
                showLogin();
                console.error('Erro no login com Google:', error);
                showNotification('Erro no login com Google: ' + getErrorMessage(error.code), 'error');
            }
        }

        async function logout() {
            try {
                const { signOut } = window.firebaseUtils;
                await signOut(window.firebaseAuth);
                showNotification('Logout realizado com sucesso!', 'success');
            } catch (error) {
                console.error('Erro no logout:', error);
                showNotification('Erro no logout!', 'error');
            }
        }

        function getErrorMessage(errorCode) {
            const errorMessages = {
                'auth/user-not-found': 'Usuário não encontrado',
                'auth/wrong-password': 'Senha incorreta',
                'auth/email-already-in-use': 'Este email já está em uso',
                'auth/weak-password': 'Senha muito fraca',
                'auth/invalid-email': 'Email inválido',
                'auth/popup-closed-by-user': 'Login cancelado pelo usuário',
                'auth/network-request-failed': 'Erro de conexão'
            };
            
            return errorMessages[errorCode] || 'Erro desconhecido';
        }

        // Sistema Firestore em Tempo Real
        function setupFirebaseListeners() {
            const { onSnapshot, collection, query, where } = window.firebaseUtils;
            
            // Listener para clientes (sem orderBy para evitar erro de índice)
            const clientesQuery = query(
                collection(window.firebaseDB, 'clientes'),
                where('userId', '==', currentUser.uid)
            );
            onSnapshot(clientesQuery, (snapshot) => {
                clientes = [];
                snapshot.forEach((doc) => {
                    clientes.push({ ...doc.data(), id: doc.id });
                });
                // Ordenar no frontend
                clientes.sort((a, b) => a.nome.localeCompare(b.nome));
                updateClientesList();
                updateClienteSelect();
            });
            
            // Listener para procedimentos (sem orderBy para evitar erro de índice)
            const procedimentosQuery = query(
                collection(window.firebaseDB, 'procedimentos'),
                where('userId', '==', currentUser.uid)
            );
            onSnapshot(procedimentosQuery, (snapshot) => {
                procedimentos = [];
                snapshot.forEach((doc) => {
                    procedimentos.push({ ...doc.data(), id: doc.id });
                });
                // Ordenar no frontend
                procedimentos.sort((a, b) => a.nome.localeCompare(b.nome));
                updateProcedimentosList();
                updateProcedimentoSelect();
            });
            
            // Listener para agendamentos (sem orderBy para evitar erro de índice)
            const agendamentosQuery = query(
                collection(window.firebaseDB, 'agendamentos'),
                where('userId', '==', currentUser.uid)
            );
            onSnapshot(agendamentosQuery, (snapshot) => {
                agendamentos = [];
                snapshot.forEach((doc) => {
                    agendamentos.push({ ...doc.data(), id: doc.id });
                });
                // Ordenar no frontend
                agendamentos.sort((a, b) => a.data.localeCompare(b.data));
                updateAgendamentosHoje();
                updateCalendar();
            });
        }

        async function loadFirebaseData() {
            const { getDocs, collection, query, where } = window.firebaseUtils;
            
            try {
                // Carregar clientes (sem orderBy)
                const clientesQuery = query(
                    collection(window.firebaseDB, 'clientes'),
                    where('userId', '==', currentUser.uid)
                );
                const clientesSnapshot = await getDocs(clientesQuery);
                clientes = [];
                clientesSnapshot.forEach((doc) => {
                    clientes.push({ ...doc.data(), id: doc.id });
                });
                clientes.sort((a, b) => a.nome.localeCompare(b.nome));
                
                // Carregar procedimentos (sem orderBy)
                const procedimentosQuery = query(
                    collection(window.firebaseDB, 'procedimentos'),
                    where('userId', '==', currentUser.uid)
                );
                const procedimentosSnapshot = await getDocs(procedimentosQuery);
                procedimentos = [];
                procedimentosSnapshot.forEach((doc) => {
                    procedimentos.push({ ...doc.data(), id: doc.id });
                });
                procedimentos.sort((a, b) => a.nome.localeCompare(b.nome));
                
                // Carregar agendamentos (sem orderBy)
                const agendamentosQuery = query(
                    collection(window.firebaseDB, 'agendamentos'),
                    where('userId', '==', currentUser.uid)
                );
                const agendamentosSnapshot = await getDocs(agendamentosQuery);
                agendamentos = [];
                agendamentosSnapshot.forEach((doc) => {
                    agendamentos.push({ ...doc.data(), id: doc.id });
                });
                agendamentos.sort((a, b) => a.data.localeCompare(b.data));
                
                // Atualizar interface
                updateClientesList();
                updateProcedimentosList();
                updateClienteSelect();
                updateProcedimentoSelect();
                updateAgendamentosHoje();
                updateCalendar();
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showNotification('Erro ao carregar dados!', 'error');
            }
        }

        // Navegação entre abas
        function showTab(tabName) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            document.getElementById(tabName + '-tab').classList.add('fade-in');
            
            // Atualizar botões de navegação
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });
            
            event.target.classList.remove('btn-secondary');
            event.target.classList.add('btn-primary');
        }

        // Cadastro de Cliente
        document.getElementById('cliente-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            console.log('Iniciando cadastro de cliente...');
            console.log('Firebase DB:', window.firebaseDB);
            console.log('Current User:', currentUser);
            
            if (!currentUser) {
                showNotification('Usuário não autenticado!', 'error');
                return;
            }
            
            const clienteId = document.getElementById('cliente-id').value;
            const cliente = {
                nome: document.getElementById('cliente-nome').value,
                nascimento: document.getElementById('cliente-nascimento').value,
                endereco: document.getElementById('cliente-endereco').value,
                bairro: document.getElementById('cliente-bairro').value,
                cidade: document.getElementById('cliente-cidade').value,
                telefone: document.getElementById('cliente-telefone').value,
                responsavel: document.getElementById('cliente-responsavel').value,
                rg: document.getElementById('cliente-rg').value,
                cpf: document.getElementById('cliente-cpf').value,
                anamnese: {
                    alergia: document.getElementById('alergia').value,
                    alergiaEspecificar: document.getElementById('alergia-especificar').value,
                    gestante: document.getElementById('gestante').value,
                    doencaOcular: document.getElementById('doenca-ocular').value,
                    doencaEspecificar: document.getElementById('doenca-especificar').value,
                    observacoes: document.getElementById('observacoes').value
                },
                userId: currentUser.uid,
                updatedAt: new Date().toISOString()
            };
            
            console.log('Dados do cliente:', cliente);
            
            try {
                const { doc, setDoc, addDoc, collection } = window.firebaseUtils;
                
                if (clienteId) {
                    // Editar cliente existente
                    console.log('Editando cliente existente...');
                    await setDoc(doc(window.firebaseDB, 'clientes', clienteId), cliente);
                    showNotification('Cliente atualizado com sucesso!', 'success');
                } else {
                    // Novo cliente
                    console.log('Criando novo cliente...');
                    cliente.createdAt = new Date().toISOString();
                    const docRef = await addDoc(collection(window.firebaseDB, 'clientes'), cliente);
                    console.log('Cliente criado com ID:', docRef.id);
                    showNotification('Cliente cadastrado com sucesso!', 'success');
                }
                
                resetClienteForm();
            } catch (error) {
                console.error('Erro detalhado ao salvar cliente:', error);
                showNotification('Erro ao salvar cliente: ' + error.message, 'error');
            }
        });

        // Cancelar edição de cliente
        document.getElementById('cancelar-edicao').addEventListener('click', function() {
            resetClienteForm();
        });

        function resetClienteForm() {
            document.getElementById('cliente-form').reset();
            document.getElementById('cliente-id').value = '';
            document.getElementById('cliente-form-title').textContent = 'Cadastrar Cliente';
            document.getElementById('cliente-btn-text').textContent = 'Cadastrar Cliente';
            document.getElementById('cancelar-edicao').classList.add('hidden');
            document.querySelector('.fa-user-plus, .fa-edit').className = 'fas fa-user-plus text-3xl gold-text mr-4';
        }

        // Cadastro de Procedimento
        document.getElementById('procedimento-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            console.log('Iniciando cadastro de procedimento...');
            console.log('Firebase DB:', window.firebaseDB);
            console.log('Current User:', currentUser);
            
            if (!currentUser) {
                console.error('Usuário não autenticado!');
                showNotification('Usuário não autenticado!', 'error');
                return;
            }
            
            // Aguardar Firebase estar completamente carregado
            if (!window.firebaseReady || !window.firebaseUtils) {
                console.error('Firebase não está pronto!');
                showNotification('Sistema ainda carregando, tente novamente!', 'error');
                return;
            }
            
            const procedimento = {
                nome: document.getElementById('procedimento-nome').value.trim(),
                valor: parseFloat(document.getElementById('procedimento-valor').value) || 0,
                duracao: document.getElementById('procedimento-duracao').value.trim() || '',
                descricao: document.getElementById('procedimento-descricao').value.trim() || '',
                userId: currentUser.uid,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            console.log('Dados do procedimento:', procedimento);
            
            // Validações básicas
            if (!procedimento.nome) {
                showNotification('Nome do procedimento é obrigatório!', 'error');
                return;
            }
            
            if (procedimento.valor <= 0) {
                showNotification('Valor deve ser maior que zero!', 'error');
                return;
            }
            
            try {
                const { addDoc, collection, doc, setDoc } = window.firebaseUtils;
                
                console.log('Salvando procedimento no Firestore...');
                console.log('Collection path: procedimentos');
                console.log('User ID:', currentUser.uid);
                
                // Tentar usar setDoc com ID gerado manualmente como alternativa
                const procedimentoId = 'proc_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const docRef = doc(window.firebaseDB, 'procedimentos', procedimentoId);
                
                await setDoc(docRef, procedimento);
                
                console.log('Procedimento criado com sucesso! ID:', procedimentoId);
                
                // Reset form
                this.reset();
                
                // Show success message
                showNotification('Procedimento cadastrado com sucesso! 💅', 'success');
                
            } catch (error) {
                console.error('Erro detalhado ao salvar procedimento:', error);
                console.error('Error code:', error.code);
                console.error('Error message:', error.message);
                
                // Tentar diagnóstico do erro
                if (error.code === 'permission-denied') {
                    console.error('Erro de permissão - verificar regras do Firestore');
                    showNotification('Erro de permissão. Verifique as configurações do Firebase.', 'error');
                } else if (error.code === 'unavailable') {
                    showNotification('Serviço temporariamente indisponível. Tente novamente.', 'error');
                } else {
                    showNotification('Erro ao salvar procedimento: ' + error.message, 'error');
                }
            }
        });

        // Agendamento
        document.getElementById('agendamento-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const agendamento = {
                clienteId: document.getElementById('cliente-select').value,
                procedimentoId: document.getElementById('procedimento-select').value,
                pagamento: document.getElementById('pagamento-select').value,
                data: document.getElementById('data-agendamento').value,
                hora: document.getElementById('hora-agendamento').value,
                status: 'agendado',
                userId: currentUser.uid,
                createdAt: new Date().toISOString()
            };
            
            try {
                const { addDoc, collection } = window.firebaseUtils;
                await addDoc(collection(window.firebaseDB, 'agendamentos'), agendamento);
                
                // Reset form
                this.reset();
                document.getElementById('valor-display').value = '';
                
                // Show success message
                showNotification('Agendamento realizado com sucesso! 📅', 'success');
            } catch (error) {
                console.error('Erro ao salvar agendamento:', error);
                showNotification('Erro ao salvar agendamento!', 'error');
            }
        });

        // Atualizar valor quando procedimento é selecionado
        document.getElementById('procedimento-select').addEventListener('change', function() {
            const procedimentoId = this.value;
            const procedimento = procedimentos.find(p => p.id == procedimentoId);
            
            if (procedimento) {
                document.getElementById('valor-display').value = `R$ ${procedimento.valor.toFixed(2)}`;
            } else {
                document.getElementById('valor-display').value = '';
            }
        });

        // Atualizar valor no modal de edição
        document.getElementById('edit-procedimento-select').addEventListener('change', function() {
            const procedimentoId = this.value;
            const procedimento = procedimentos.find(p => p.id == procedimentoId);
            
            if (procedimento) {
                document.getElementById('edit-valor-display').value = `R$ ${procedimento.valor.toFixed(2)}`;
            } else {
                document.getElementById('edit-valor-display').value = '';
            }
        });

        // Edição de Agendamento
        document.getElementById('edit-agendamento-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const agendamentoId = document.getElementById('edit-agendamento-id').value;
            
            const agendamentoAtualizado = {
                clienteId: document.getElementById('edit-cliente-select').value,
                procedimentoId: document.getElementById('edit-procedimento-select').value,
                pagamento: document.getElementById('edit-pagamento-select').value,
                data: document.getElementById('edit-data-agendamento').value,
                hora: document.getElementById('edit-hora-agendamento').value,
                status: 'agendado',
                userId: currentUser.uid,
                updatedAt: new Date().toISOString()
            };
            
            try {
                const { doc, setDoc } = window.firebaseUtils;
                await setDoc(doc(window.firebaseDB, 'agendamentos', agendamentoId), agendamentoAtualizado);
                
                closeModalAgendamento();
                showNotification('Agendamento atualizado com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao atualizar agendamento:', error);
                showNotification('Erro ao atualizar agendamento!', 'error');
            }
        });

        function openModalAgendamento(agendamentoId) {
            const agendamento = agendamentos.find(a => a.id == agendamentoId);
            if (!agendamento) return;
            
            // Preencher selects
            updateEditClienteSelect();
            updateEditProcedimentoSelect();
            
            // Preencher dados do agendamento
            document.getElementById('edit-agendamento-id').value = agendamento.id;
            document.getElementById('edit-cliente-select').value = agendamento.clienteId;
            document.getElementById('edit-procedimento-select').value = agendamento.procedimentoId;
            document.getElementById('edit-pagamento-select').value = agendamento.pagamento;
            document.getElementById('edit-data-agendamento').value = agendamento.data;
            document.getElementById('edit-hora-agendamento').value = agendamento.hora;
            
            // Atualizar valor
            const procedimento = procedimentos.find(p => p.id == agendamento.procedimentoId);
            if (procedimento) {
                document.getElementById('edit-valor-display').value = `R$ ${procedimento.valor.toFixed(2)}`;
            }
            
            document.getElementById('modal-agendamento').classList.remove('hidden');
        }

        function closeModalAgendamento() {
            document.getElementById('modal-agendamento').classList.add('hidden');
            document.getElementById('edit-agendamento-form').reset();
        }

        function updateEditClienteSelect() {
            const select = document.getElementById('edit-cliente-select');
            select.innerHTML = '<option value="">Selecione um cliente</option>';
            
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.id;
                option.textContent = cliente.nome;
                select.appendChild(option);
            });
        }

        function updateEditProcedimentoSelect() {
            const select = document.getElementById('edit-procedimento-select');
            select.innerHTML = '<option value="">Selecione um procedimento</option>';
            
            procedimentos.forEach(procedimento => {
                const option = document.createElement('option');
                option.value = procedimento.id;
                option.textContent = `${procedimento.nome} - R$ ${procedimento.valor.toFixed(2)}`;
                select.appendChild(option);
            });
        }

        // Funções de atualização das listas
        function updateClientesList(filtro = '') {
            const lista = document.getElementById('lista-clientes');
            lista.innerHTML = '';
            
            if (clientes.length === 0) {
                lista.innerHTML = '<p class="text-gray-400 text-center py-8">Nenhum cliente cadastrado</p>';
                return;
            }
            
            // Ordenar alfabeticamente e filtrar
            let clientesFiltrados = clientes
                .filter(cliente => cliente.nome.toLowerCase().includes(filtro.toLowerCase()))
                .sort((a, b) => a.nome.localeCompare(b.nome));
            
            if (clientesFiltrados.length === 0) {
                lista.innerHTML = '<p class="text-gray-400 text-center py-8">Nenhum cliente encontrado</p>';
                return;
            }
            
            clientesFiltrados.forEach(cliente => {
                const div = document.createElement('div');
                div.className = 'glass-effect p-4 rounded-xl border border-yellow-500/30 card-hover';
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div class="flex-1 cursor-pointer" onclick="editCliente('${cliente.id}')">
                            <h4 class="font-bold text-yellow-300 text-lg">${cliente.nome}</h4>
                        </div>
                        <button onclick="deleteCliente('${cliente.id}')" class="text-red-400 hover:text-red-300 p-2 rounded-lg hover:bg-red-500/20 transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                lista.appendChild(div);
            });
        }

        function editCliente(clienteId) {
            const cliente = clientes.find(c => c.id == clienteId);
            if (!cliente) return;
            
            // Preencher formulário
            document.getElementById('cliente-id').value = cliente.id;
            document.getElementById('cliente-nome').value = cliente.nome;
            document.getElementById('cliente-nascimento').value = cliente.nascimento || '';
            document.getElementById('cliente-endereco').value = cliente.endereco || '';
            document.getElementById('cliente-bairro').value = cliente.bairro || '';
            document.getElementById('cliente-cidade').value = cliente.cidade || '';
            document.getElementById('cliente-telefone').value = cliente.telefone;
            document.getElementById('cliente-responsavel').value = cliente.responsavel || '';
            document.getElementById('cliente-rg').value = cliente.rg || '';
            document.getElementById('cliente-cpf').value = cliente.cpf || '';
            
            // Preencher anamnese
            if (cliente.anamnese) {
                document.getElementById('alergia').value = cliente.anamnese.alergia || '';
                document.getElementById('alergia-especificar').value = cliente.anamnese.alergiaEspecificar || '';
                document.getElementById('gestante').value = cliente.anamnese.gestante || '';
                document.getElementById('doenca-ocular').value = cliente.anamnese.doencaOcular || '';
                document.getElementById('doenca-especificar').value = cliente.anamnese.doencaEspecificar || '';
                document.getElementById('observacoes').value = cliente.anamnese.observacoes || '';
            }
            
            // Atualizar interface
            document.getElementById('cliente-form-title').textContent = 'Editar Cliente';
            document.getElementById('cliente-btn-text').textContent = 'Salvar Alterações';
            document.getElementById('cancelar-edicao').classList.remove('hidden');
            document.querySelector('.fa-user-plus').className = 'fas fa-edit text-3xl gold-text mr-4';
        }

        function updateProcedimentosList() {
            const lista = document.getElementById('lista-procedimentos');
            lista.innerHTML = '';
            
            if (procedimentos.length === 0) {
                lista.innerHTML = '<p class="text-gray-400 text-center py-8">Nenhum procedimento cadastrado</p>';
                return;
            }
            
            procedimentos.forEach(procedimento => {
                const div = document.createElement('div');
                div.className = 'glass-effect p-6 rounded-xl border border-yellow-500/30 hover-scale';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-bold text-yellow-300 text-lg mb-2">${procedimento.nome}</h4>
                            <div class="space-y-1">
                                <p class="text-green-400 font-bold text-xl">R$ ${procedimento.valor.toFixed(2)}</p>
                                ${procedimento.duracao ? `<p class="text-gray-300 flex items-center">
                                    <i class="fas fa-clock mr-2 text-yellow-400"></i>${procedimento.duracao} minutos
                                </p>` : ''}
                                ${procedimento.descricao ? `<p class="text-gray-300 mt-2">${procedimento.descricao}</p>` : ''}
                            </div>
                        </div>
                        <button onclick="deleteProcedimento('${procedimento.id}')" class="text-red-400 hover:text-red-300 p-2 rounded-lg hover:bg-red-500/20 transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                lista.appendChild(div);
            });
        }

        function updateClienteSelect() {
            const select = document.getElementById('cliente-select');
            select.innerHTML = '<option value="">Selecione um cliente</option>';
            
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.id;
                option.textContent = cliente.nome;
                select.appendChild(option);
            });
        }

        function updateProcedimentoSelect() {
            const select = document.getElementById('procedimento-select');
            select.innerHTML = '<option value="">Selecione um procedimento</option>';
            
            procedimentos.forEach(procedimento => {
                const option = document.createElement('option');
                option.value = procedimento.id;
                option.textContent = `${procedimento.nome} - R$ ${procedimento.valor.toFixed(2)}`;
                select.appendChild(option);
            });
        }

        function updateAgendamentosHoje(filtro = '') {
            const hoje = new Date().toISOString().split('T')[0];
            let agendamentosHoje = agendamentos.filter(a => a.data === hoje);
            
            // Filtrar por cliente ou procedimento
            if (filtro) {
                agendamentosHoje = agendamentosHoje.filter(agendamento => {
                    const cliente = clientes.find(c => c.id == agendamento.clienteId);
                    const procedimento = procedimentos.find(p => p.id == agendamento.procedimentoId);
                    return (cliente?.nome.toLowerCase().includes(filtro.toLowerCase())) ||
                           (procedimento?.nome.toLowerCase().includes(filtro.toLowerCase()));
                });
            }
            
            const container = document.getElementById('agendamentos-hoje');
            container.innerHTML = '';
            
            if (agendamentosHoje.length === 0) {
                const mensagem = filtro ? 'Nenhum agendamento encontrado' : 'Nenhum agendamento para hoje';
                container.innerHTML = `<p class="text-gray-400 text-center py-8">${mensagem}</p>`;
                return;
            }
            
            agendamentosHoje.sort((a, b) => a.hora.localeCompare(b.hora));
            
            agendamentosHoje.forEach(agendamento => {
                const cliente = clientes.find(c => c.id == agendamento.clienteId);
                const procedimento = procedimentos.find(p => p.id == agendamento.procedimentoId);
                
                const div = document.createElement('div');
                div.className = 'glass-effect p-6 rounded-xl border border-yellow-500/30 hover-scale';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1" onclick="openModalAgendamento('${agendamento.id}')">
                            <div class="flex items-center mb-3">
                                <i class="fas fa-clock text-yellow-400 mr-2"></i>
                                <h4 class="font-bold text-yellow-300 text-lg">${agendamento.hora}</h4>
                            </div>
                            <div class="space-y-2">
                                <p class="text-white flex items-center">
                                    <i class="fas fa-user mr-2 text-yellow-400"></i>
                                    ${cliente?.nome || 'Cliente não encontrado'}
                                </p>
                                <p class="text-gray-300 flex items-center">
                                    <i class="fas fa-spa mr-2 text-yellow-400"></i>
                                    ${procedimento?.nome || 'Procedimento não encontrado'}
                                </p>
                                <p class="text-green-400 font-bold text-lg flex items-center">
                                    <i class="fas fa-dollar-sign mr-2"></i>
                                    R$ ${procedimento?.valor.toFixed(2) || '0.00'}
                                </p>
                                <p class="text-gray-300 flex items-center">
                                    <i class="fas fa-credit-card mr-2 text-yellow-400"></i>
                                    ${agendamento.pagamento}
                                </p>
                            </div>
                        </div>
                        <button onclick="deleteAgendamento('${agendamento.id}')" class="text-red-400 hover:text-red-300 p-2 rounded-lg hover:bg-red-500/20 transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Calendário
        function updateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('current-month').textContent = 
                currentDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day glass-effect p-4 rounded-xl text-center cursor-pointer border border-yellow-500/20';
                
                const dateStr = date.toISOString().split('T')[0];
                const dayAppointments = agendamentos.filter(a => a.data === dateStr);
                const hasAppointments = dayAppointments.length > 0;
                
                if (hasAppointments) {
                    dayElement.classList.add('has-appointment');
                }
                
                if (date.getMonth() !== month) {
                    dayElement.classList.add('text-gray-500');
                } else {
                    dayElement.classList.add('text-white');
                }
                
                dayElement.innerHTML = `
                    <div class="font-bold text-lg">${date.getDate()}</div>
                    ${hasAppointments ? `<div class="text-xs mt-1 text-yellow-400">${dayAppointments.length} agend.</div>` : ''}
                `;
                
                dayElement.addEventListener('click', () => selectDate(dateStr));
                grid.appendChild(dayElement);
            }
        }

        function selectDate(dateStr) {
            selectedDate = dateStr;
            
            // Highlight selected date
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('ring-2', 'ring-yellow-400');
            });
            
            event.target.closest('.calendar-day').classList.add('ring-2', 'ring-yellow-400');
            
            // Show appointments for selected date
            const agendamentosData = agendamentos.filter(a => a.data === dateStr);
            const container = document.getElementById('agendamentos-dia');
            container.innerHTML = '';
            
            if (agendamentosData.length === 0) {
                container.innerHTML = '<p class="text-gray-400">Nenhum agendamento para este dia</p>';
                return;
            }
            
            agendamentosData.sort((a, b) => a.hora.localeCompare(b.hora));
            
            agendamentosData.forEach(agendamento => {
                const cliente = clientes.find(c => c.id == agendamento.clienteId);
                const procedimento = procedimentos.find(p => p.id == agendamento.procedimentoId);
                
                const div = document.createElement('div');
                div.className = 'glass-effect p-6 rounded-xl border border-yellow-500/30 hover-scale';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1" onclick="openModalAgendamento('${agendamento.id}')">
                            <div class="flex items-center mb-3">
                                <i class="fas fa-clock text-yellow-400 mr-2"></i>
                                <h4 class="font-bold text-yellow-300 text-lg">${agendamento.hora}</h4>
                            </div>
                            <div class="space-y-2">
                                <p class="text-white flex items-center">
                                    <i class="fas fa-user mr-2 text-yellow-400"></i>
                                    ${cliente?.nome || 'Cliente não encontrado'}
                                </p>
                                <p class="text-gray-300 flex items-center">
                                    <i class="fas fa-spa mr-2 text-yellow-400"></i>
                                    ${procedimento?.nome || 'Procedimento não encontrado'}
                                </p>
                                <p class="text-green-400 font-bold text-lg flex items-center">
                                    <i class="fas fa-dollar-sign mr-2"></i>
                                    R$ ${procedimento?.valor.toFixed(2) || '0.00'}
                                </p>
                                <p class="text-gray-300 flex items-center">
                                    <i class="fas fa-credit-card mr-2 text-yellow-400"></i>
                                    ${agendamento.pagamento}
                                </p>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            updateCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            updateCalendar();
        }

        // Funções de exclusão
        async function deleteCliente(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                try {
                    const { doc, deleteDoc } = window.firebaseUtils;
                    await deleteDoc(doc(window.firebaseDB, 'clientes', id));
                    showNotification('Cliente excluído com sucesso!', 'success');
                } catch (error) {
                    console.error('Erro ao excluir cliente:', error);
                    showNotification('Erro ao excluir cliente!', 'error');
                }
            }
        }

        async function deleteProcedimento(id) {
            if (confirm('Tem certeza que deseja excluir este procedimento?')) {
                try {
                    const { doc, deleteDoc } = window.firebaseUtils;
                    await deleteDoc(doc(window.firebaseDB, 'procedimentos', id));
                    showNotification('Procedimento excluído com sucesso!', 'success');
                } catch (error) {
                    console.error('Erro ao excluir procedimento:', error);
                    showNotification('Erro ao excluir procedimento!', 'error');
                }
            }
        }

        async function deleteAgendamento(id) {
            if (confirm('Tem certeza que deseja excluir este agendamento?')) {
                try {
                    const { doc, deleteDoc } = window.firebaseUtils;
                    await deleteDoc(doc(window.firebaseDB, 'agendamentos', id));
                    showNotification('Agendamento excluído com sucesso!', 'success');
                } catch (error) {
                    console.error('Erro ao excluir agendamento:', error);
                    showNotification('Erro ao excluir agendamento!', 'error');
                }
            }
        }

        // Sistema de Notificações de Agendamento
        let notificationsShown = new Set();
        
        function checkUpcomingAppointments() {
            const now = new Date();
            const hoje = now.toISOString().split('T')[0];
            const agendamentosHoje = agendamentos.filter(a => a.data === hoje);
            
            agendamentosHoje.forEach(agendamento => {
                const [hora, minuto] = agendamento.hora.split(':').map(Number);
                const agendamentoTime = new Date();
                agendamentoTime.setHours(hora, minuto, 0, 0);
                
                const diffMinutes = (agendamentoTime - now) / (1000 * 60);
                
                // Notificar 2 horas antes (120 minutos)
                if (diffMinutes <= 120 && diffMinutes > 0 && !notificationsShown.has(agendamento.id)) {
                    const cliente = clientes.find(c => c.id == agendamento.clienteId);
                    const procedimento = procedimentos.find(p => p.id == agendamento.procedimentoId);
                    
                    showAppointmentAlert(agendamento, cliente, procedimento, diffMinutes);
                    notificationsShown.add(agendamento.id);
                }
            });
        }
        
        function showAppointmentAlert(agendamento, cliente, procedimento, minutesLeft) {
            const horasRestantes = Math.floor(minutesLeft / 60);
            const minutosRestantes = Math.floor(minutesLeft % 60);
            
            let tempoTexto = '';
            if (horasRestantes > 0) {
                tempoTexto = `${horasRestantes}h ${minutosRestantes}min`;
            } else {
                tempoTexto = `${minutosRestantes} minutos`;
            }
            
            const alertDiv = document.createElement('div');
            alertDiv.id = `alert-${agendamento.id}`;
            alertDiv.className = 'notification-alert glass-effect p-6 rounded-xl border-2 border-yellow-400 bg-yellow-900/50 text-white shadow-2xl';
            alertDiv.innerHTML = `
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-3">
                            <i class="fas fa-bell text-yellow-400 text-2xl mr-3"></i>
                            <h3 class="font-bold text-lg text-yellow-300">Próximo Cliente!</h3>
                        </div>
                        <div class="space-y-2">
                            <p class="font-semibold">
                                <i class="fas fa-user mr-2 text-yellow-400"></i>
                                ${cliente?.nome || 'Cliente não encontrado'}
                            </p>
                            <p class="text-gray-300">
                                <i class="fas fa-spa mr-2 text-yellow-400"></i>
                                ${procedimento?.nome || 'Procedimento não encontrado'}
                            </p>
                            <p class="font-bold text-yellow-300">
                                <i class="fas fa-clock mr-2"></i>
                                ${agendamento.hora} - em ${tempoTexto}
                            </p>
                        </div>
                    </div>
                    <button onclick="dismissAlert('${agendamento.id}')" class="btn-primary px-4 py-2 rounded-lg font-bold ml-4">
                        <i class="fas fa-check mr-2"></i>Entendi
                    </button>
                </div>
            `;
            
            document.getElementById('notification-area').appendChild(alertDiv);
        }
        
        function dismissAlert(agendamentoId) {
            const alert = document.getElementById(`alert-${agendamentoId}`);
            if (alert) {
                alert.style.animation = 'slideUp 0.3s ease-out';
                setTimeout(() => alert.remove(), 300);
            }
        }
        
        // Notificações
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-6 rounded-xl shadow-2xl ${
                type === 'success' ? 'bg-green-600' : 'bg-red-600'
            } text-white font-bold slide-down flex items-center`;
            
            const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
            notification.innerHTML = `
                <i class="${icon} mr-3 text-xl"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease-out reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98863f6d0503a429',t:'MTc1OTQyOTU4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
