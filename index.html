<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda de Clientes - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        wine: '#722F37',
                        'wine-dark': '#5A252A',
                        gold: '#D4AF37',
                        'gold-light': '#E6C659'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            box-sizing: border-box;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #000000 0%, #722F37 100%);
        }
        .blur-bg {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        .loading-spinner {
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            border-top: 3px solid #D4AF37;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tab-button {
            background: rgba(114, 47, 55, 0.5);
            color: #E6C659;
            border: 2px solid rgba(212, 175, 55, 0.4);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        .tab-button.active {
            background: linear-gradient(135deg, #D4AF37, #E6C659);
            color: #000;
            border: 2px solid #D4AF37;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }
        .tab-button:hover:not(.active) {
            background: rgba(114, 47, 55, 0.7);
            border-color: rgba(212, 175, 55, 0.6);
            color: #F4E4A6;
        }
        .calendar-day {
            transition: all 0.2s;
        }
        .calendar-day:hover {
            background: rgba(212, 175, 55, 0.2);
        }
        .calendar-day.has-appointment {
            background: rgba(212, 175, 55, 0.3);
            border: 1px solid #D4AF37;
        }
        .calendar-day.selected {
            background: #D4AF37;
            color: #000;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .status-presente {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
        }
        .status-faltou {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
        }
        .status-pendente {
            background: linear-gradient(135deg, #F59E0B, #D97706);
            color: white;
        }
        .stats-card {
            background: linear-gradient(135deg, rgba(114, 47, 55, 0.3), rgba(114, 47, 55, 0.1));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.3);
            transition: all 0.3s ease;
        }
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(212, 175, 55, 0.2);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Background decorativo -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-40 right-20 w-24 h-24 bg-wine/20 rounded-full blur-lg floating-animation" style="animation-delay: -2s;"></div>
        <div class="absolute bottom-32 right-1/4 w-40 h-40 bg-wine/5 rounded-full blur-2xl floating-animation" style="animation-delay: -4s;"></div>
    </div>

    <!-- Tela de Login -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center px-4">
        <div class="w-full max-w-md">
            <!-- Logo e t√≠tulo -->
            <div class="text-center mb-8">
                <div class="w-20 h-20 mx-auto bg-gradient-to-br from-gold/30 to-gold/10 rounded-2xl border-2 border-gold/40 flex items-center justify-center mb-4 blur-bg shadow-2xl">
                    <div class="w-8 h-8 bg-gold rounded-lg shadow-lg"></div>
                </div>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-gold to-gold-light bg-clip-text text-transparent mb-2">Agenda Profissional</h1>
                <p class="text-gray-300 text-lg">Fa√ßa login para acessar sua agenda</p>
            </div>

            <!-- Formul√°rio de Login -->
            <div class="bg-black/30 blur-bg rounded-2xl p-8 border border-wine/20 shadow-2xl">
                <div id="loginForm">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-gold font-medium mb-2">Email</label>
                            <input type="email" id="email" required
                                   class="w-full px-4 py-3 bg-wine/20 border border-wine/50 rounded-lg text-white placeholder-gray-400 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/20 transition-all"
                                   placeholder="seu@email.com">
                        </div>
                        
                        <div>
                            <label class="block text-gold font-medium mb-2">Senha</label>
                            <input type="password" id="password" required
                                   class="w-full px-4 py-3 bg-wine/20 border border-wine/50 rounded-lg text-white placeholder-gray-400 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/20 transition-all"
                                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>

                        <button id="loginBtn" type="button" 
                                class="w-full bg-gold hover:bg-gold-light text-black font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 flex items-center justify-center">
                            <span id="loginBtnText">Entrar</span>
                            <div id="loginSpinner" class="loading-spinner ml-2 hidden"></div>
                        </button>

                        <div class="relative">
                            <div class="absolute inset-0 flex items-center">
                                <div class="w-full border-t border-wine/30"></div>
                            </div>
                            <div class="relative flex justify-center text-sm">
                                <span class="px-2 bg-black/30 text-gray-400">ou</span>
                            </div>
                        </div>

                        <button id="googleBtn" type="button"
                                class="w-full bg-white hover:bg-gray-100 text-gray-800 font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Entrar com Google
                        </button>

                        <div class="text-center">
                            <button id="toggleMode" class="text-gold hover:text-gold-light transition-colors text-sm">
                                N√£o tem conta? Criar uma
                            </button>
                        </div>
                    </div>
                </div>

                <div id="errorMessage" class="hidden mt-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-300 text-sm"></div>
            </div>
        </div>
    </div>

    <!-- Tela da Agenda -->
    <div id="agendaScreen" class="hidden min-h-screen">
        <div class="container mx-auto px-4 py-6">
            <!-- Header com espa√ßo para logo -->
            <header class="mb-8 bg-black/30 blur-bg rounded-2xl p-6 border border-wine/20 shadow-2xl fade-in">
                <!-- Espa√ßo para logo da loja -->
                <div class="text-center mb-6 p-4 bg-wine/10 rounded-xl border border-wine/30">
                    <div class="text-gold text-lg font-semibold">ESPA√áO PARA LOGO DA LOJA</div>
                    <div class="text-gray-400 text-sm mt-1">Adicione aqui o logo da sua empresa</div>
                </div>
                
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h1 class="text-3xl font-bold text-gold">Agenda de Clientes</h1>
                        <p class="text-gray-200 text-sm mt-1" id="userEmail"></p>
                    </div>
                    <button id="logoutBtn" class="bg-wine hover:bg-wine-dark text-white px-6 py-3 rounded-xl transition-all duration-200 shadow-lg">
                        Sair
                    </button>
                </div>

                <!-- Estat√≠sticas do Dia -->
                <div class="mb-4">
                    <h3 class="text-xl font-bold text-gold mb-3">üìÖ Agendamentos de Hoje - <span id="todayDate"></span></h3>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4">
                    <button id="statsTotalBtn" class="stats-card rounded-lg md:rounded-xl p-3 md:p-4 text-center hover:scale-105 transition-all cursor-pointer">
                        <div class="text-lg md:text-2xl font-bold text-gold" id="totalAgendamentos">0</div>
                        <div class="text-xs md:text-sm text-gray-300">Total Hoje</div>
                    </button>
                    <button id="statsPresentesBtn" class="stats-card rounded-lg md:rounded-xl p-3 md:p-4 text-center hover:scale-105 transition-all cursor-pointer">
                        <div class="text-lg md:text-2xl font-bold text-green-400" id="totalPresentes">0</div>
                        <div class="text-xs md:text-sm text-gray-300">Compareceram</div>
                    </button>
                    <button id="statsFaltaramBtn" class="stats-card rounded-lg md:rounded-xl p-3 md:p-4 text-center hover:scale-105 transition-all cursor-pointer">
                        <div class="text-lg md:text-2xl font-bold text-red-400" id="totalFaltaram">0</div>
                        <div class="text-xs md:text-sm text-gray-300">Faltaram</div>
                    </button>
                    <button id="statsPendentesBtn" class="stats-card rounded-lg md:rounded-xl p-3 md:p-4 text-center hover:scale-105 transition-all cursor-pointer">
                        <div class="text-lg md:text-2xl font-bold text-yellow-400" id="totalPendentes">0</div>
                        <div class="text-xs md:text-sm text-gray-300">Pendentes</div>
                    </button>
                </div>
            </header>

            <!-- Navega√ß√£o por abas -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-1 md:gap-2 mb-6 md:mb-8 bg-black/40 blur-bg rounded-xl md:rounded-2xl p-2 md:p-3 border-2 border-wine/30 fade-in shadow-xl">
                <button id="tabAgenda" class="tab-button active px-2 md:px-6 py-2 md:py-4 rounded-lg md:rounded-xl font-bold transition-all duration-200 text-center text-xs md:text-base">
                    <div class="flex flex-col items-center">
                        <span class="text-lg md:text-xl mb-1">üìÖ</span>
                        <span class="hidden sm:block md:hidden text-xs">Agenda</span>
                        <span class="hidden md:block">Agendamentos</span>
                    </div>
                </button>
                <button id="tabClientes" class="tab-button px-2 md:px-6 py-2 md:py-4 rounded-lg md:rounded-xl font-bold transition-all duration-200 text-center text-xs md:text-base">
                    <div class="flex flex-col items-center">
                        <span class="text-lg md:text-xl mb-1">üë•</span>
                        <span class="hidden sm:block md:hidden text-xs">Clientes</span>
                        <span class="hidden md:block">Clientes</span>
                    </div>
                </button>
                <button id="tabCalendar" class="tab-button px-2 md:px-6 py-2 md:py-4 rounded-lg md:rounded-xl font-bold transition-all duration-200 text-center text-xs md:text-base">
                    <div class="flex flex-col items-center">
                        <span class="text-lg md:text-xl mb-1">üìÖ</span>
                        <span class="hidden sm:block md:hidden text-xs">Calend√°rio</span>
                        <span class="hidden md:block">Calend√°rio</span>
                    </div>
                </button>
                <button id="tabRelatorios" class="tab-button px-2 md:px-6 py-2 md:py-4 rounded-lg md:rounded-xl font-bold transition-all duration-200 text-center text-xs md:text-base">
                    <div class="flex flex-col items-center">
                        <span class="text-lg md:text-xl mb-1">üìä</span>
                        <span class="hidden sm:block md:hidden text-xs">Relat√≥rios</span>
                        <span class="hidden md:block">Relat√≥rios</span>
                    </div>
                </button>
            </div>

            <!-- Conte√∫do da aba Agendamentos -->
            <div id="agendaContent">
                <!-- Formul√°rio -->
                <div class="bg-black/40 blur-bg rounded-xl md:rounded-2xl p-4 md:p-8 mb-6 md:mb-8 border-2 border-wine/30 shadow-2xl">
                    <div class="mb-4 md:mb-6">
                        <h2 class="text-xl md:text-3xl font-bold text-gold">‚ú® Novo Agendamento</h2>
                    </div>
                    <form id="clientForm" class="space-y-4 md:space-y-0 md:grid md:grid-cols-2 md:gap-6">
                        <div class="relative md:col-span-1">
                            <label class="block text-white font-bold mb-2 text-sm md:text-lg">üë§ Nome do Cliente</label>
                            <input type="text" id="clientName" required 
                                   class="w-full px-3 md:px-5 py-3 md:py-4 bg-wine/40 border-2 border-wine/60 rounded-lg md:rounded-xl text-white placeholder-gray-300 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all duration-200 text-sm md:text-base"
                                   placeholder="Digite ou pesquise o nome do cliente"
                                   autocomplete="off">
                            <div id="clientSearchResults" class="absolute top-full left-0 right-0 bg-black/95 border-2 border-wine/60 rounded-lg md:rounded-xl mt-1 max-h-60 overflow-y-auto z-10 hidden shadow-xl">
                                <!-- Resultados da pesquisa aparecer√£o aqui -->
                            </div>
                        </div>
                        
                        <div class="md:col-span-1">
                            <label class="block text-white font-bold mb-2 text-sm md:text-lg">üíº Servi√ßo</label>
                            <input type="text" id="service" required
                                   class="w-full px-3 md:px-5 py-3 md:py-4 bg-wine/40 border-2 border-wine/60 rounded-lg md:rounded-xl text-white placeholder-gray-300 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all duration-200 text-sm md:text-base"
                                   placeholder="Tipo de servi√ßo">
                        </div>
                        
                        <div class="md:col-span-1">
                            <label class="block text-white font-bold mb-2 text-sm md:text-lg">üìÖ Data</label>
                            <input type="date" id="date" required
                                   class="w-full px-3 md:px-5 py-3 md:py-4 bg-wine/40 border-2 border-wine/60 rounded-lg md:rounded-xl text-white focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all duration-200 text-sm md:text-base">
                        </div>
                        
                        <div class="md:col-span-1">
                            <label class="block text-white font-bold mb-2 text-sm md:text-lg">‚è∞ Hor√°rio</label>
                            <input type="time" id="time" required
                                   class="w-full px-3 md:px-5 py-3 md:py-4 bg-wine/40 border-2 border-wine/60 rounded-lg md:rounded-xl text-white focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all duration-200 text-sm md:text-base">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-white font-bold mb-2 text-sm md:text-lg">üìù Observa√ß√µes</label>
                            <textarea id="notes" rows="3" 
                                      class="w-full px-3 md:px-5 py-3 md:py-4 bg-wine/40 border-2 border-wine/60 rounded-lg md:rounded-xl text-white placeholder-gray-300 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 resize-none transition-all duration-200 text-sm md:text-base"
                                      placeholder="Observa√ß√µes adicionais..."></textarea>
                        </div>
                        
                        <div class="md:col-span-2">
                            <button type="submit" 
                                    class="w-full bg-gradient-to-r from-gold to-gold-light hover:from-gold-light hover:to-gold text-black font-bold py-3 md:py-4 px-6 md:px-8 rounded-lg md:rounded-xl transition-all duration-200 text-sm md:text-lg shadow-lg hover:shadow-xl transform hover:scale-105">
                                ‚ú® Agendar Cliente
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Lista de agendamentos -->
                <div class="bg-black/40 blur-bg rounded-xl md:rounded-2xl p-4 md:p-8 border-2 border-wine/30 shadow-2xl fade-in">
                    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 md:mb-6 gap-3 md:gap-4">
                        <h2 class="text-xl md:text-3xl font-bold text-gold">üìã Seus Agendamentos</h2>
                        <div class="grid grid-cols-2 md:flex gap-1 md:gap-2">
                            <button id="filterAll" class="px-2 md:px-3 py-2 bg-gold text-black rounded-lg font-bold text-xs md:text-sm transition-all shadow-md">
                                Todos
                            </button>
                            <button id="filterPendente" class="px-2 md:px-3 py-2 bg-wine/40 text-white rounded-lg font-bold text-xs md:text-sm transition-all border border-wine/50">
                                Pendentes
                            </button>
                            <button id="filterPresente" class="px-2 md:px-3 py-2 bg-wine/40 text-white rounded-lg font-bold text-xs md:text-sm transition-all border border-wine/50">
                                Presentes
                            </button>
                            <button id="filterFaltou" class="px-2 md:px-3 py-2 bg-wine/40 text-white rounded-lg font-bold text-xs md:text-sm transition-all border border-wine/50">
                                Faltaram
                            </button>
                        </div>
                    </div>
                    <div id="appointmentsList" class="space-y-3 md:space-y-4">
                        <!-- Agendamentos aparecer√£o aqui -->
                    </div>
                    <div id="emptyState" class="text-center py-8 md:py-12">
                        <p class="text-lg md:text-xl font-semibold mb-2 text-white">Nenhum agendamento ainda</p>
                        <p class="text-sm md:text-lg text-gray-300">Adicione seu primeiro cliente acima</p>
                    </div>
                </div>
            </div>

            <!-- Conte√∫do da aba Clientes -->
            <div id="clientesContent" class="hidden">
                <!-- Formul√°rio de Cliente -->
                <div class="bg-black/40 blur-bg rounded-2xl p-8 mb-8 border border-wine/30 shadow-2xl">
                    <div class="mb-6">
                        <h2 class="text-3xl font-bold text-gold">üë• Cadastro de Clientes</h2>
                    </div>
                    <form id="clienteForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-white font-bold mb-3 text-lg">Nome Completo *</label>
                            <input type="text" id="clienteNome" required 
                                   class="w-full px-5 py-4 bg-wine/30 border-2 border-wine/50 rounded-xl text-white placeholder-gray-300 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all duration-200"
                                   placeholder="Nome completo do cliente">
                        </div>
                        
                        <div>
                            <label class="block text-white font-bold mb-3 text-lg">Data de Nascimento *</label>
                            <input type="date" id="clienteNascimento" required
                                   class="w-full px-5 py-4 bg-wine/30 border-2 border-wine/50 rounded-xl text-white focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all duration-200">
                        </div>
                        
                        <div>
                            <label class="block text-white font-bold mb-3 text-lg">Sexo *</label>
                            <select id="clienteSexo" required
                                    class="w-full px-5 py-4 bg-wine/30 border-2 border-wine/50 rounded-xl text-white focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all duration-200">
                                <option value="">Selecione</option>
                                <option value="feminino">Feminino</option>
                                <option value="masculino">Masculino</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-white font-bold mb-3 text-lg">Telefone *</label>
                            <input type="tel" id="clienteTelefone" required
                                   class="w-full px-5 py-4 bg-wine/30 border-2 border-wine/50 rounded-xl text-white placeholder-gray-300 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all duration-200"
                                   placeholder="(11) 99999-9999">
                        </div>
                        
                        <div>
                            <label class="block text-white font-bold mb-3 text-lg">Email</label>
                            <input type="email" id="clienteEmail"
                                   class="w-full px-5 py-4 bg-wine/30 border border-wine/50 rounded-xl text-white placeholder-gray-300 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all duration-200"
                                   placeholder="cliente@email.com">
                        </div>
                        
                        <div>
                            <label class="block text-white font-bold mb-3 text-lg">Profiss√£o</label>
                            <input type="text" id="clienteProfissao"
                                   class="w-full px-5 py-4 bg-wine/30 border border-wine/50 rounded-xl text-white placeholder-gray-300 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all duration-200"
                                   placeholder="Profiss√£o do cliente">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-white font-bold mb-3 text-lg">Observa√ß√µes</label>
                            <textarea id="clienteObservacoes" rows="4"
                                      class="w-full px-5 py-4 bg-wine/30 border border-wine/50 rounded-xl text-white placeholder-gray-300 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 resize-none transition-all duration-200"
                                      placeholder="Observa√ß√µes sobre o cliente, prefer√™ncias, alergias, etc..."></textarea>
                        </div>
                        
                        <div class="md:col-span-2">
                            <button type="submit" 
                                    class="w-full bg-gold hover:bg-gold-light text-black font-bold py-4 px-8 rounded-xl transition-all duration-200 text-lg">
                                üíæ Cadastrar Cliente
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Lista de Clientes -->
                <div class="bg-black/40 blur-bg rounded-2xl p-8 border border-wine/30 shadow-2xl fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-gold">Lista de Clientes</h2>
                        <div class="flex gap-4">
                            <input type="text" id="searchClientes" 
                                   class="px-4 py-2 bg-wine/30 border border-wine/50 rounded-xl text-white placeholder-gray-300 focus:border-gold focus:outline-none"
                                   placeholder="Pesquisar cliente...">
                        </div>
                    </div>
                    <div id="clientesList" class="space-y-4">
                        <!-- Clientes aparecer√£o aqui -->
                    </div>
                    <div id="clientesEmptyState" class="text-center py-12">
                        <p class="text-xl font-semibold mb-2 text-white">Nenhum cliente cadastrado</p>
                        <p class="text-lg text-gray-300">Cadastre seu primeiro cliente acima</p>
                    </div>
                </div>
            </div>

            <!-- Conte√∫do da aba Calend√°rio -->
            <div id="calendarContent" class="hidden">
                <div class="bg-black/40 blur-bg rounded-2xl p-8 border border-wine/30 shadow-2xl fade-in">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h2 class="text-3xl font-bold text-gold">Calend√°rio</h2>
                        </div>
                        <div class="flex items-center space-x-4">
                            <button id="prevMonth" class="bg-wine hover:bg-wine-dark text-white px-4 py-3 rounded-xl transition-all duration-200 font-semibold">
                                ‚Üê
                            </button>
                            <span id="currentMonth" class="text-white font-bold text-xl min-w-[200px] text-center"></span>
                            <button id="nextMonth" class="bg-wine hover:bg-wine-dark text-white px-4 py-3 rounded-xl transition-all duration-200 font-semibold">
                                ‚Üí
                            </button>
                        </div>
                    </div>
                    
                    <div id="calendar" class="grid grid-cols-7 gap-3 mb-8">
                        <!-- Calend√°rio ser√° gerado aqui -->
                    </div>
                    
                    <div id="selectedDateInfo" class="p-6 bg-gradient-to-r from-wine/20 to-wine/30 rounded-2xl border border-wine/40 hidden shadow-lg">
                        <h3 class="text-gold font-bold text-xl mb-4">üìÖ Agendamentos do dia:</h3>
                        <div id="dayAppointments"></div>
                    </div>
                </div>
            </div>

            <!-- Conte√∫do da aba Relat√≥rios -->
            <div id="relatoriosContent" class="hidden">
                <div class="space-y-8">
                    <!-- Relat√≥rio Mensal -->
                    <div class="bg-black/40 blur-bg rounded-2xl p-8 border border-wine/30 shadow-2xl fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-3xl font-bold text-gold">Relat√≥rio Mensal</h2>
                            <select id="monthSelect" class="bg-wine/30 border border-wine/50 rounded-xl text-white px-4 py-2 focus:border-gold focus:outline-none">
                                <!-- Op√ß√µes ser√£o preenchidas via JavaScript -->
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="stats-card rounded-xl p-6 text-center">
                                <div class="text-3xl font-bold text-gold mb-2" id="monthlyTotal">0</div>
                                <div class="text-gray-300">Total do M√™s</div>
                            </div>
                            <div class="stats-card rounded-xl p-6 text-center">
                                <div class="text-3xl font-bold text-green-400 mb-2" id="monthlyPresentes">0</div>
                                <div class="text-gray-300">Compareceram</div>
                            </div>
                            <div class="stats-card rounded-xl p-6 text-center">
                                <div class="text-3xl font-bold text-red-400 mb-2" id="monthlyFaltaram">0</div>
                                <div class="text-gray-300">Faltaram</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Lista de quem compareceu -->
                            <div class="bg-green-500/10 border border-green-500/30 rounded-xl p-6">
                                <h3 class="text-green-400 font-bold text-xl mb-4">‚úÖ Compareceram</h3>
                                <div id="listaPresentes" class="space-y-2 max-h-60 overflow-y-auto">
                                    <!-- Lista ser√° preenchida via JavaScript -->
                                </div>
                            </div>

                            <!-- Lista de quem faltou -->
                            <div class="bg-red-500/10 border border-red-500/30 rounded-xl p-6">
                                <h3 class="text-red-400 font-bold text-xl mb-4">‚ùå Faltaram</h3>
                                <div id="listaFaltaram" class="space-y-2 max-h-60 overflow-y-auto">
                                    <!-- Lista ser√° preenchida via JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gr√°fico de Frequ√™ncia -->
                    <div class="bg-black/40 blur-bg rounded-2xl p-8 border border-wine/30 shadow-2xl fade-in">
                        <h2 class="text-3xl font-bold text-gold mb-6">Frequ√™ncia de Clientes</h2>
                        <div id="frequenciaClientes" class="space-y-4">
                            <!-- Gr√°fico ser√° gerado aqui -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o -->
    <div id="editModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="bg-black/90 border border-wine/30 rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gold">‚úèÔ∏è Editar Agendamento</h2>
                <button id="closeEditModal" class="text-gray-400 hover:text-white text-2xl">√ó</button>
            </div>
            
            <form id="editForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-white font-bold mb-3">Nome do Cliente</label>
                    <input type="text" id="editClientName" required 
                           class="w-full px-4 py-3 bg-wine/30 border border-wine/50 rounded-xl text-white placeholder-gray-300 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all">
                </div>
                
                <div>
                    <label class="block text-white font-bold mb-3">Servi√ßo</label>
                    <input type="text" id="editService" required
                           class="w-full px-4 py-3 bg-wine/30 border border-wine/50 rounded-xl text-white placeholder-gray-300 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all">
                </div>
                
                <div>
                    <label class="block text-white font-bold mb-3">Data</label>
                    <input type="date" id="editDate" required
                           class="w-full px-4 py-3 bg-wine/30 border border-wine/50 rounded-xl text-white focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all">
                </div>
                
                <div>
                    <label class="block text-white font-bold mb-3">Hor√°rio</label>
                    <input type="time" id="editTime" required
                           class="w-full px-4 py-3 bg-wine/30 border border-wine/50 rounded-xl text-white focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 transition-all">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-white font-bold mb-3">Observa√ß√µes</label>
                    <textarea id="editNotes" rows="3"
                              class="w-full px-4 py-3 bg-wine/30 border border-wine/50 rounded-xl text-white placeholder-gray-300 focus:border-gold focus:outline-none focus:ring-2 focus:ring-gold/30 resize-none transition-all"></textarea>
                </div>
                
                <div class="md:col-span-2 flex gap-4">
                    <button type="submit" class="flex-1 bg-gold hover:bg-gold-light text-black font-bold py-3 px-6 rounded-xl transition-all">
                        üíæ Salvar Altera√ß√µes
                    </button>
                    <button type="button" id="cancelEdit" class="flex-1 bg-wine hover:bg-wine-dark text-white font-bold py-3 px-6 rounded-xl transition-all">
                        ‚ùå Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Detalhes das Estat√≠sticas -->
    <div id="statsModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="bg-black/90 border border-wine/30 rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 id="statsModalTitle" class="text-2xl font-bold text-gold"></h2>
                <button id="closeStatsModal" class="text-gray-400 hover:text-white text-2xl">√ó</button>
            </div>
            
            <div id="statsModalContent" class="space-y-4">
                <!-- Conte√∫do ser√° preenchido dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Notifica√ß√£o de Lembrete -->
    <div id="reminderNotification" class="fixed top-4 right-4 bg-gradient-to-r from-gold to-gold-light text-black p-6 rounded-2xl shadow-2xl border-2 border-gold hidden z-50 max-w-sm">
        <div class="flex items-center gap-3 mb-2">
            <div class="text-2xl">‚è∞</div>
            <div class="font-bold text-lg">Lembrete!</div>
        </div>
        <div id="reminderContent" class="text-sm font-medium"></div>
        <button id="closeReminder" class="absolute top-2 right-2 text-black/60 hover:text-black text-xl">√ó</button>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, deleteDoc, doc, where, updateDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBUF8USZ4eHJPqM6SBiHDGhOmvYpZmVSnk",
            authDomain: "agenda-lashes-f3766.firebaseapp.com",
            projectId: "agenda-lashes-f3766",
            storageBucket: "agenda-lashes-f3766.firebasestorage.app",
            messagingSenderId: "321642421475",
            appId: "1:321642421475:web:cea7c933f29ff5bea1b9d6",
            measurementId: "G-62GWTEQG3W"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let currentUser = null;
        let isLoginMode = true;
        let unsubscribeAppointments = null;
        let currentDate = new Date();
        let appointments = [];
        let clientes = [];
        let activeTab = 'agenda';
        let currentFilter = 'all';
        let reminderInterval = null;
        let editingAppointment = null;

        // Elementos DOM
        const loginScreen = document.getElementById('loginScreen');
        const agendaScreen = document.getElementById('agendaScreen');
        const loginBtn = document.getElementById('loginBtn');
        const googleBtn = document.getElementById('googleBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const toggleMode = document.getElementById('toggleMode');
        const errorMessage = document.getElementById('errorMessage');
        const clientForm = document.getElementById('clientForm');
        const appointmentsList = document.getElementById('appointmentsList');
        const emptyState = document.getElementById('emptyState');
        const tabAgenda = document.getElementById('tabAgenda');
        const tabClientes = document.getElementById('tabClientes');
        const tabCalendar = document.getElementById('tabCalendar');
        const tabRelatorios = document.getElementById('tabRelatorios');
        const agendaContent = document.getElementById('agendaContent');
        const clientesContent = document.getElementById('clientesContent');
        const calendarContent = document.getElementById('calendarContent');
        const relatoriosContent = document.getElementById('relatoriosContent');
        const calendar = document.getElementById('calendar');
        const currentMonth = document.getElementById('currentMonth');
        const prevMonth = document.getElementById('prevMonth');
        const nextMonth = document.getElementById('nextMonth');

        // Fun√ß√µes de utilidade
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000);
        }

        function setLoading(isLoading) {
            const spinner = document.getElementById('loginSpinner');
            const btnText = document.getElementById('loginBtnText');
            
            if (isLoading) {
                spinner.classList.remove('hidden');
                btnText.textContent = 'Entrando...';
                loginBtn.disabled = true;
                googleBtn.disabled = true;
            } else {
                spinner.classList.add('hidden');
                btnText.textContent = isLoginMode ? 'Entrar' : 'Criar Conta';
                loginBtn.disabled = false;
                googleBtn.disabled = false;
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function switchTab(tab) {
            activeTab = tab;
            
            // Atualizar bot√µes das abas
            tabAgenda.classList.toggle('active', tab === 'agenda');
            tabClientes.classList.toggle('active', tab === 'clientes');
            tabCalendar.classList.toggle('active', tab === 'calendar');
            tabRelatorios.classList.toggle('active', tab === 'relatorios');
            
            // Mostrar/esconder conte√∫do
            agendaContent.classList.toggle('hidden', tab !== 'agenda');
            clientesContent.classList.toggle('hidden', tab !== 'clientes');
            calendarContent.classList.toggle('hidden', tab !== 'calendar');
            relatoriosContent.classList.toggle('hidden', tab !== 'relatorios');
            
            if (tab === 'calendar') {
                generateCalendar();
            } else if (tab === 'relatorios') {
                generateReports();
            } else if (tab === 'clientes') {
                loadClientes();
            }
        }

        function generateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Atualizar t√≠tulo do m√™s
            currentMonth.textContent = new Date(year, month).toLocaleDateString('pt-BR', { 
                month: 'long', 
                year: 'numeric' 
            });
            
            // Limpar calend√°rio
            calendar.innerHTML = '';
            
            // Cabe√ßalho dos dias da semana
            const daysOfWeek = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            daysOfWeek.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'text-center text-gold font-bold py-4 text-lg bg-wine/20 rounded-xl border border-wine/30';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // Primeiro dia do m√™s e √∫ltimo dia
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            // Gerar dias do calend√°rio
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day text-center py-4 px-3 rounded-xl cursor-pointer border border-transparent font-semibold text-lg transition-all duration-200 hover:scale-105';
                
                const isCurrentMonth = date.getMonth() === month;
                const dateString = date.toISOString().split('T')[0];
                const hasAppointment = appointments.some(apt => apt.date === dateString);
                
                if (!isCurrentMonth) {
                    dayElement.className += ' text-gray-500 bg-black/10';
                } else {
                    dayElement.className += ' text-white bg-wine/10 border-wine/20';
                }
                
                if (hasAppointment) {
                    dayElement.className += ' has-appointment bg-gradient-to-br from-gold/30 to-gold/20 border-gold/50 text-black font-bold shadow-lg';
                }
                
                dayElement.textContent = date.getDate();
                dayElement.addEventListener('click', () => selectDate(dateString));
                
                calendar.appendChild(dayElement);
            }
        }

        function selectDate(dateString) {
            // Remover sele√ß√£o anterior
            document.querySelectorAll('.calendar-day.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Adicionar sele√ß√£o atual
            event.target.classList.add('selected');
            
            // Mostrar agendamentos do dia
            const dayAppointments = appointments.filter(apt => apt.date === dateString);
            const selectedDateInfo = document.getElementById('selectedDateInfo');
            const dayAppointmentsDiv = document.getElementById('dayAppointments');
            
            if (dayAppointments.length > 0) {
                selectedDateInfo.classList.remove('hidden');
                dayAppointmentsDiv.innerHTML = dayAppointments.map(apt => {
                    const statusClass = apt.status === 'presente' ? 'bg-green-500/20 border-green-500/30' : 
                                       apt.status === 'faltou' ? 'bg-red-500/20 border-red-500/30' : 
                                       'bg-yellow-500/20 border-yellow-500/30';
                    const statusText = apt.status === 'presente' ? '‚úÖ Compareceu' : 
                                      apt.status === 'faltou' ? '‚ùå Faltou' : '‚è≥ Pendente';
                    
                    return `
                        <div class="${statusClass} rounded-xl p-4 mb-3 border shadow-lg">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <h4 class="text-gold font-bold text-lg mb-2">${apt.name}</h4>
                                    <div class="flex items-center gap-4 text-gray-300 mb-2">
                                        <span class="bg-gold/20 text-gold px-3 py-1 rounded-full text-sm font-semibold">${apt.service}</span>
                                        <span class="font-medium">${apt.time}</span>
                                    </div>
                                    ${apt.notes ? `<p class="text-gray-400 text-sm mt-2 bg-black/20 p-2 rounded-lg"><strong>Obs:</strong> ${apt.notes}</p>` : ''}
                                </div>
                                <span class="text-sm font-semibold">${statusText}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                selectedDateInfo.classList.remove('hidden');
                dayAppointmentsDiv.innerHTML = '<div class="text-center py-6"><div class="w-12 h-12 mx-auto mb-3 bg-wine/20 rounded-xl border border-wine/30 flex items-center justify-center"><div class="w-4 h-4 border-2 border-gray-400 rounded"></div></div><p class="text-gray-400 text-lg">Nenhum agendamento neste dia</p></div>';
            }
        }

        function updateCalendarView(appointmentsData) {
            appointments = appointmentsData;
            if (activeTab === 'calendar') {
                generateCalendar();
            }
        }

        // Autentica√ß√£o
        async function handleEmailAuth() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!email || !password) {
                showError('Por favor, preencha todos os campos');
                return;
            }

            setLoading(true);

            try {
                if (isLoginMode) {
                    await signInWithEmailAndPassword(auth, email, password);
                } else {
                    await createUserWithEmailAndPassword(auth, email, password);
                }
            } catch (error) {
                let message = 'Erro ao fazer login';
                if (error.code === 'auth/user-not-found') {
                    message = 'Usu√°rio n√£o encontrado';
                } else if (error.code === 'auth/wrong-password') {
                    message = 'Senha incorreta';
                } else if (error.code === 'auth/email-already-in-use') {
                    message = 'Este email j√° est√° em uso';
                } else if (error.code === 'auth/weak-password') {
                    message = 'A senha deve ter pelo menos 6 caracteres';
                } else if (error.code === 'auth/invalid-email') {
                    message = 'Email inv√°lido';
                }
                showError(message);
            } finally {
                setLoading(false);
            }
        }

        async function handleGoogleAuth() {
            setLoading(true);
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                showError('Erro ao fazer login com Google');
            } finally {
                setLoading(false);
            }
        }

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            const btnText = document.getElementById('loginBtnText');
            btnText.textContent = isLoginMode ? 'Entrar' : 'Criar Conta';
            toggleMode.textContent = isLoginMode ? 'N√£o tem conta? Criar uma' : 'J√° tem conta? Fazer login';
        }

        // Gerenciamento de clientes com Firebase
        function loadClientes() {
            if (!currentUser) return;

            try {
                // Criar query para clientes do usu√°rio
                const clientesQuery = query(
                    collection(db, 'clientes'),
                    where('userId', '==', currentUser.uid),
                    orderBy('nome')
                );

                // Listener em tempo real
                onSnapshot(clientesQuery, (snapshot) => {
                    clientes = [];
                    snapshot.forEach((doc) => {
                        clientes.push({ id: doc.id, ...doc.data() });
                    });
                    
                    renderClientes(clientes);
                }, (error) => {
                    console.error("Erro ao carregar clientes:", error);
                    showError('Erro ao carregar clientes');
                });
            } catch (error) {
                console.error("Erro ao configurar listener de clientes:", error);
                showError('Erro ao configurar sincroniza√ß√£o de clientes');
            }
        }

        function renderClientes(clientesList) {
            const clientesListDiv = document.getElementById('clientesList');
            const emptyState = document.getElementById('clientesEmptyState');

            if (clientesList.length === 0) {
                clientesListDiv.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            
            // Ordenar por ordem alfab√©tica
            const sortedClientes = [...clientesList].sort((a, b) => a.nome.localeCompare(b.nome));
            
            clientesListDiv.innerHTML = sortedClientes.map(cliente => {
                const idade = cliente.nascimento ? 
                    Math.floor((new Date() - new Date(cliente.nascimento)) / (365.25 * 24 * 60 * 60 * 1000)) : 
                    'N/A';
                
                return `
                    <div class="bg-wine/20 border-2 border-wine/40 rounded-2xl hover:bg-wine/30 transition-all duration-200 slide-in cursor-pointer" onclick="toggleClienteDetails('${cliente.id}')">
                        <!-- Vista Compacta -->
                        <div class="p-6">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-4">
                                    <h3 class="text-2xl font-bold text-gold">${cliente.nome}</h3>
                                    <span class="bg-wine/40 text-white px-3 py-1 rounded-full text-sm font-semibold border border-wine/50">${idade} anos</span>
                                    <span class="bg-gold/20 text-gold px-3 py-1 rounded-full text-sm font-semibold border border-gold/40">${cliente.sexo || 'N/A'}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-gold text-sm font-medium">Clique para ver detalhes</span>
                                    <span class="text-gold text-xl" id="arrow-${cliente.id}">‚ñº</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detalhes Completos (Inicialmente Ocultos) -->
                        <div id="details-${cliente.id}" class="hidden border-t-2 border-wine/40 bg-wine/10 p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-white mb-4">
                                <div><span class="text-gold font-semibold">üìû Telefone:</span> ${cliente.telefone}</div>
                                ${cliente.email ? `<div><span class="text-gold font-semibold">üìß Email:</span> ${cliente.email}</div>` : '<div><span class="text-gold font-semibold">üìß Email:</span> N√£o informado</div>'}
                                ${cliente.profissao ? `<div><span class="text-gold font-semibold">üíº Profiss√£o:</span> ${cliente.profissao}</div>` : '<div><span class="text-gold font-semibold">üíº Profiss√£o:</span> N√£o informada</div>'}
                                <div><span class="text-gold font-semibold">üéÇ Nascimento:</span> ${formatDate(cliente.nascimento)}</div>
                            </div>
                            
                            ${cliente.observacoes ? `
                                <div class="bg-black/30 rounded-xl p-4 mb-4 border border-wine/20">
                                    <p class="text-white"><span class="text-gold font-semibold">üìù Observa√ß√µes:</span> ${cliente.observacoes}</p>
                                </div>
                            ` : ''}
                            
                            <div class="flex gap-3 pt-4 border-t border-wine/30">
                                <button onclick="event.stopPropagation(); editCliente('${cliente.id}')" 
                                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl transition-all duration-200 font-semibold shadow-lg">
                                    ‚úèÔ∏è Editar Cliente
                                </button>
                                <button onclick="event.stopPropagation(); deleteCliente('${cliente.id}')" 
                                        class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-xl transition-all duration-200 font-semibold shadow-lg">
                                    üóëÔ∏è Excluir Cliente
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function addCliente(event) {
            event.preventDefault();
            
            if (!currentUser) {
                showError('Usu√°rio n√£o autenticado');
                return;
            }

            const nome = document.getElementById('clienteNome').value.trim();
            const nascimento = document.getElementById('clienteNascimento').value;
            const sexo = document.getElementById('clienteSexo').value;
            const telefone = document.getElementById('clienteTelefone').value.trim();
            const email = document.getElementById('clienteEmail').value.trim();
            const profissao = document.getElementById('clienteProfissao').value.trim();
            const observacoes = document.getElementById('clienteObservacoes').value.trim();

            if (!nome || !nascimento || !sexo || !telefone) {
                showError('Por favor, preencha todos os campos obrigat√≥rios (*)');
                return;
            }

            try {
                const newCliente = {
                    userId: currentUser.uid,
                    nome,
                    nascimento,
                    sexo,
                    telefone,
                    email,
                    profissao,
                    observacoes,
                    createdAt: new Date().toISOString()
                };

                await addDoc(collection(db, 'clientes'), newCliente);
                
                document.getElementById('clienteForm').reset();
                
            } catch (error) {
                console.error('Erro ao adicionar cliente:', error);
                showError('Erro ao adicionar cliente: ' + error.message);
            }
        }

        // Fun√ß√£o para expandir/recolher detalhes do cliente
        window.toggleClienteDetails = function(clienteId) {
            const detailsDiv = document.getElementById(`details-${clienteId}`);
            const arrow = document.getElementById(`arrow-${clienteId}`);
            
            if (detailsDiv.classList.contains('hidden')) {
                detailsDiv.classList.remove('hidden');
                arrow.textContent = '‚ñ≤';
            } else {
                detailsDiv.classList.add('hidden');
                arrow.textContent = '‚ñº';
            }
        };

        function searchClientes(searchTerm) {
            if (!searchTerm.trim()) {
                document.getElementById('clientSearchResults').classList.add('hidden');
                return;
            }

            const filteredClientes = clientes.filter(cliente => 
                cliente.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||
                (cliente.telefone && cliente.telefone.includes(searchTerm)) ||
                (cliente.email && cliente.email.toLowerCase().includes(searchTerm))
            );

            const resultsDiv = document.getElementById('clientSearchResults');
            
            if (filteredClientes.length > 0) {
                resultsDiv.innerHTML = filteredClientes.map(cliente => `
                    <div class="p-4 hover:bg-wine/30 cursor-pointer border-b border-wine/20 last:border-b-0 client-result transition-all" 
                         data-client-id="${cliente.id}">
                        <div class="font-bold text-gold text-lg">${cliente.nome}</div>
                    </div>
                `).join('');
                resultsDiv.classList.remove('hidden');
                
                // Adicionar event listeners para cada resultado
                resultsDiv.querySelectorAll('.client-result').forEach(element => {
                    element.addEventListener('click', () => {
                        const clientId = element.getAttribute('data-client-id');
                        selectCliente(clientId);
                    });
                });
            } else {
                resultsDiv.innerHTML = '<div class="p-3 text-gray-400 text-center">Nenhum cliente encontrado</div>';
                resultsDiv.classList.remove('hidden');
            }
        }

        function selectCliente(clientId) {
            const cliente = clientes.find(c => c.id === clientId);
            if (cliente) {
                document.getElementById('clientName').value = cliente.nome;
                document.getElementById('clientSearchResults').classList.add('hidden');
                
                // Opcional: preencher outros campos se necess√°rio
                // Por exemplo, se voc√™ quiser preencher observa√ß√µes automaticamente:
                // if (cliente.observacoes) {
                //     document.getElementById('notes').value = cliente.observacoes;
                // }
            }
        }

        window.editCliente = function(id) {
            // Implementar edi√ß√£o de cliente
            console.log('Editar cliente:', id);
        };

        window.deleteCliente = async function(id) {
            if (!currentUser) return;
            
            try {
                await deleteDoc(doc(db, 'clientes', id));
                console.log('Cliente exclu√≠do:', id);
                
            } catch (error) {
                console.error('Erro ao excluir cliente:', error);
                showError('Erro ao excluir cliente');
            }
        };

        // Gerenciamento de agendamentos com Firebase
        function loadAppointments() {
            if (!currentUser) return;

            try {
                // Criar query para agendamentos do usu√°rio
                const appointmentsQuery = query(
                    collection(db, 'appointments'),
                    where('userId', '==', currentUser.uid),
                    orderBy('date'),
                    orderBy('time')
                );

                // Listener em tempo real
                if (unsubscribeAppointments) {
                    unsubscribeAppointments();
                }

                unsubscribeAppointments = onSnapshot(appointmentsQuery, (snapshot) => {
                    appointments = [];
                    snapshot.forEach((doc) => {
                        appointments.push({ id: doc.id, ...doc.data() });
                    });
                    
                    console.log('Agendamentos carregados:', appointments);
                    renderAppointments(appointments);
                    updateCalendarView(appointments);
                    updateStats();
                }, (error) => {
                    console.error("Erro ao carregar agendamentos:", error);
                    showError('Erro ao carregar agendamentos');
                });
            } catch (error) {
                console.error("Erro ao configurar listener:", error);
                showError('Erro ao configurar sincroniza√ß√£o');
            }
        }

        function renderAppointments(appointments) {
            // Filtrar agendamentos baseado no filtro atual
            let filteredAppointments = appointments;
            if (currentFilter !== 'all') {
                filteredAppointments = appointments.filter(apt => apt.status === currentFilter);
            }

            if (filteredAppointments.length === 0) {
                appointmentsList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            
            appointmentsList.innerHTML = filteredAppointments.map(apt => {
                const status = apt.status || 'pendente';
                const statusClass = status === 'presente' ? 'status-presente' : 
                                  status === 'faltou' ? 'status-faltou' : 'status-pendente';
                const statusText = status === 'presente' ? '‚úÖ Compareceu' : 
                                 status === 'faltou' ? '‚ùå Faltou' : '‚è≥ Pendente';
                
                return `
                    <div class="bg-wine/20 border border-wine/40 rounded-xl md:rounded-2xl p-4 md:p-6 hover:bg-wine/30 transition-all duration-200 slide-in">
                        <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-4">
                            <div class="flex-1">
                                <!-- Header Mobile/Desktop -->
                                <div class="flex flex-col md:flex-row md:items-center gap-2 md:gap-4 mb-3 md:mb-4">
                                    <h3 class="text-lg md:text-2xl font-bold text-gold">${apt.name}</h3>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="bg-gold/20 text-gold px-3 py-1 rounded-full text-xs md:text-sm font-semibold border border-gold/30">
                                            ${apt.service}
                                        </span>
                                        <span class="${statusClass} px-2 md:px-3 py-1 rounded-full text-xs font-bold">
                                            ${statusText}
                                        </span>
                                    </div>
                                </div>
                                
                                <!-- Data e Hor√°rio -->
                                <div class="flex flex-col md:flex-row md:items-center gap-2 md:gap-8 text-white mb-3 text-sm md:text-base">
                                    <div class="flex items-center gap-2">
                                        <span class="font-medium">üìÖ ${formatDate(apt.date)}</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="font-medium">‚è∞ ${apt.time}</span>
                                    </div>
                                </div>
                                
                                ${apt.notes ? `
                                    <div class="bg-black/30 rounded-lg md:rounded-xl p-3 md:p-4 mt-3 md:mt-4 border border-wine/20">
                                        <p class="text-white text-sm md:text-base"><span class="text-gold font-semibold">üìù Observa√ß√µes:</span> ${apt.notes}</p>
                                    </div>
                                ` : ''}
                                
                                <!-- Bot√µes de Status -->
                                <div class="flex flex-wrap gap-1 md:gap-2 mt-3 md:mt-4">
                                    <button onclick="updateStatus('${apt.id}', 'presente')" 
                                            class="px-2 md:px-4 py-1 md:py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-xs md:text-sm font-semibold transition-all ${status === 'presente' ? 'ring-2 ring-green-400' : ''}">
                                        ‚úÖ Presente
                                    </button>
                                    <button onclick="updateStatus('${apt.id}', 'faltou')" 
                                            class="px-2 md:px-4 py-1 md:py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-xs md:text-sm font-semibold transition-all ${status === 'faltou' ? 'ring-2 ring-red-400' : ''}">
                                        ‚ùå Faltou
                                    </button>
                                    <button onclick="updateStatus('${apt.id}', 'pendente')" 
                                            class="px-2 md:px-4 py-1 md:py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-xs md:text-sm font-semibold transition-all ${status === 'pendente' ? 'ring-2 ring-yellow-400' : ''}">
                                        ‚è≥ Pendente
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Bot√µes de A√ß√£o -->
                            <div class="flex md:flex-col gap-2 md:ml-6">
                                <button onclick="editAppointment('${apt.id}')" 
                                        class="flex-1 md:flex-none text-blue-400 hover:text-blue-300 transition-all duration-200 p-2 md:p-3 hover:bg-blue-500/20 rounded-lg md:rounded-xl text-xs md:text-sm">
                                    ‚úèÔ∏è Editar
                                </button>
                                <button onclick="deleteAppointment('${apt.id}')" 
                                        class="flex-1 md:flex-none text-red-400 hover:text-red-300 transition-all duration-200 p-2 md:p-3 hover:bg-red-500/20 rounded-lg md:rounded-xl text-xs md:text-sm">
                                    üóëÔ∏è Excluir
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            updateStats();
        }

        async function addAppointment(event) {
            event.preventDefault();
            
            if (!currentUser) {
                showError('Usu√°rio n√£o autenticado');
                return;
            }

            const name = document.getElementById('clientName').value.trim();
            const service = document.getElementById('service').value.trim();
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const notes = document.getElementById('notes').value.trim();

            if (!name || !service || !date || !time) {
                showError('Por favor, preencha todos os campos obrigat√≥rios');
                return;
            }

            try {
                const newAppointment = {
                    userId: currentUser.uid,
                    name,
                    service,
                    date,
                    time,
                    notes,
                    status: 'pendente',
                    createdAt: new Date().toISOString()
                };

                await addDoc(collection(db, 'appointments'), newAppointment);
                
                console.log('Agendamento criado:', newAppointment);
                clientForm.reset();
                
                // Definir data atual como padr√£o
                const today = new Date();
                document.getElementById('date').value = today.toISOString().split('T')[0];
                
            } catch (error) {
                console.error('Erro ao adicionar agendamento:', error);
                showError('Erro ao adicionar agendamento: ' + error.message);
            }
        }

        // Fun√ß√£o para atualizar status do agendamento
        window.updateStatus = async function(id, newStatus) {
            if (!currentUser) return;
            
            try {
                const appointmentRef = doc(db, 'appointments', id);
                await updateDoc(appointmentRef, { status: newStatus });
                
            } catch (error) {
                console.error('Erro ao atualizar status:', error);
                showError('Erro ao atualizar status');
            }
        };

        // Fun√ß√£o para atualizar estat√≠sticas (apenas do dia atual)
        function updateStats() {
            if (!appointments || appointments.length === 0) {
                document.getElementById('totalAgendamentos').textContent = '0';
                document.getElementById('totalPresentes').textContent = '0';
                document.getElementById('totalFaltaram').textContent = '0';
                document.getElementById('totalPendentes').textContent = '0';
                
                // Atualizar data de hoje
                const todayFormatted = new Date().toLocaleDateString('pt-BR', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                document.getElementById('todayDate').textContent = todayFormatted;
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const todayAppointments = appointments.filter(apt => apt.date === today);
            
            const total = todayAppointments.length;
            const presentes = todayAppointments.filter(apt => apt.status === 'presente').length;
            const faltaram = todayAppointments.filter(apt => apt.status === 'faltou').length;
            const pendentes = todayAppointments.filter(apt => apt.status === 'pendente').length;

            document.getElementById('totalAgendamentos').textContent = total;
            document.getElementById('totalPresentes').textContent = presentes;
            document.getElementById('totalFaltaram').textContent = faltaram;
            document.getElementById('totalPendentes').textContent = pendentes;
            
            // Atualizar data de hoje
            const todayFormatted = new Date().toLocaleDateString('pt-BR', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('todayDate').textContent = todayFormatted;
        }

        // Fun√ß√£o para filtrar agendamentos
        function setFilter(filter) {
            currentFilter = filter;
            
            // Atualizar bot√µes de filtro
            document.getElementById('filterAll').className = filter === 'all' ? 
                'px-4 py-2 bg-gold text-black rounded-lg font-semibold text-sm transition-all' :
                'px-4 py-2 bg-wine/30 text-white rounded-lg font-semibold text-sm transition-all';
            document.getElementById('filterPendente').className = filter === 'pendente' ? 
                'px-4 py-2 bg-gold text-black rounded-lg font-semibold text-sm transition-all' :
                'px-4 py-2 bg-wine/30 text-white rounded-lg font-semibold text-sm transition-all';
            document.getElementById('filterPresente').className = filter === 'presente' ? 
                'px-4 py-2 bg-gold text-black rounded-lg font-semibold text-sm transition-all' :
                'px-4 py-2 bg-wine/30 text-white rounded-lg font-semibold text-sm transition-all';
            document.getElementById('filterFaltou').className = filter === 'faltou' ? 
                'px-4 py-2 bg-gold text-black rounded-lg font-semibold text-sm transition-all' :
                'px-4 py-2 bg-wine/30 text-white rounded-lg font-semibold text-sm transition-all';
            
            renderAppointments(appointments);
        }

        // Fun√ß√£o para gerar relat√≥rios
        function generateReports() {
            populateMonthSelect();
            updateMonthlyReport();
            generateFrequencyChart();
        }

        function populateMonthSelect() {
            const monthSelect = document.getElementById('monthSelect');
            const currentDate = new Date();
            const months = [];
            
            // Gerar √∫ltimos 12 meses
            for (let i = 0; i < 12; i++) {
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                months.push({
                    value: `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`,
                    text: date.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })
                });
            }
            
            monthSelect.innerHTML = months.map(month => 
                `<option value="${month.value}">${month.text}</option>`
            ).join('');
            
            monthSelect.addEventListener('change', updateMonthlyReport);
        }

        function updateMonthlyReport() {
            const monthSelect = document.getElementById('monthSelect');
            const selectedMonth = monthSelect.value;
            
            const monthlyAppointments = appointments.filter(apt => 
                apt.date.startsWith(selectedMonth)
            );
            
            const total = monthlyAppointments.length;
            const presentes = monthlyAppointments.filter(apt => apt.status === 'presente');
            const faltaram = monthlyAppointments.filter(apt => apt.status === 'faltou');
            
            document.getElementById('monthlyTotal').textContent = total;
            document.getElementById('monthlyPresentes').textContent = presentes.length;
            document.getElementById('monthlyFaltaram').textContent = faltaram.length;
            
            // Lista de presentes
            const listaPresentes = document.getElementById('listaPresentes');
            if (presentes.length > 0) {
                listaPresentes.innerHTML = presentes.map(apt => `
                    <div class="bg-green-500/20 rounded-lg p-3 border border-green-500/30">
                        <div class="font-semibold text-green-300">${apt.name}</div>
                        <div class="text-sm text-gray-400">${formatDate(apt.date)} - ${apt.service}</div>
                    </div>
                `).join('');
            } else {
                listaPresentes.innerHTML = '<div class="text-center text-gray-400 py-4">Nenhum cliente compareceu neste m√™s</div>';
            }
            
            // Lista de faltaram
            const listaFaltaram = document.getElementById('listaFaltaram');
            if (faltaram.length > 0) {
                listaFaltaram.innerHTML = faltaram.map(apt => `
                    <div class="bg-red-500/20 rounded-lg p-3 border border-red-500/30">
                        <div class="font-semibold text-red-300">${apt.name}</div>
                        <div class="text-sm text-gray-400">${formatDate(apt.date)} - ${apt.service}</div>
                    </div>
                `).join('');
            } else {
                listaFaltaram.innerHTML = '<div class="text-center text-gray-400 py-4">Nenhum cliente faltou neste m√™s</div>';
            }
        }

        function generateFrequencyChart() {
            const clientFrequency = {};
            
            appointments.forEach(apt => {
                if (apt.status === 'presente') {
                    clientFrequency[apt.name] = (clientFrequency[apt.name] || 0) + 1;
                }
            });
            
            const sortedClients = Object.entries(clientFrequency)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);
            
            const frequenciaDiv = document.getElementById('frequenciaClientes');
            
            if (sortedClients.length > 0) {
                const maxFrequency = Math.max(...sortedClients.map(([,freq]) => freq));
                
                frequenciaDiv.innerHTML = sortedClients.map(([name, frequency]) => {
                    const percentage = (frequency / maxFrequency) * 100;
                    return `
                        <div class="bg-wine/20 rounded-xl p-4 border border-wine/30">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gold font-semibold">${name}</span>
                                <span class="text-white font-bold">${frequency} visitas</span>
                            </div>
                            <div class="w-full bg-black/30 rounded-full h-3">
                                <div class="bg-gradient-to-r from-gold to-gold-light h-3 rounded-full transition-all duration-500" 
                                     style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                frequenciaDiv.innerHTML = '<div class="text-center text-gray-400 py-8">Nenhum dado de frequ√™ncia dispon√≠vel</div>';
            }
        }

        // Fun√ß√£o para editar agendamento
        window.editAppointment = function(id) {
            if (!currentUser) return;
            
            try {
                const appointment = appointments.find(apt => apt.id === id);
                if (!appointment) return;
                
                editingAppointment = appointment;
                
                // Preencher formul√°rio de edi√ß√£o
                document.getElementById('editClientName').value = appointment.name;
                document.getElementById('editService').value = appointment.service;
                document.getElementById('editDate').value = appointment.date;
                document.getElementById('editTime').value = appointment.time;
                document.getElementById('editNotes').value = appointment.notes || '';
                
                // Mostrar modal
                document.getElementById('editModal').classList.remove('hidden');
                
            } catch (error) {
                console.error('Erro ao editar agendamento:', error);
                showError('Erro ao editar agendamento');
            }
        };

        window.deleteAppointment = async function(id) {
            if (!currentUser) return;
            
            try {
                await deleteDoc(doc(db, 'appointments', id));
                console.log('Agendamento exclu√≠do:', id);
                
            } catch (error) {
                console.error('Erro ao excluir agendamento:', error);
                showError('Erro ao excluir agendamento');
            }
        };

        // Fun√ß√£o para mostrar detalhes das estat√≠sticas
        function showStatsDetails(type) {
            const today = new Date().toISOString().split('T')[0];
            const todayAppointments = appointments.filter(apt => apt.date === today);
            
            let filteredAppointments = [];
            let title = '';
            
            switch(type) {
                case 'total':
                    filteredAppointments = todayAppointments;
                    title = 'üìÖ Todos os Agendamentos de Hoje';
                    break;
                case 'presente':
                    filteredAppointments = todayAppointments.filter(apt => apt.status === 'presente');
                    title = '‚úÖ Clientes que Compareceram Hoje';
                    break;
                case 'faltou':
                    filteredAppointments = todayAppointments.filter(apt => apt.status === 'faltou');
                    title = '‚ùå Clientes que Faltaram Hoje';
                    break;
                case 'pendente':
                    filteredAppointments = todayAppointments.filter(apt => apt.status === 'pendente');
                    title = '‚è≥ Agendamentos Pendentes de Hoje';
                    break;
            }
            
            document.getElementById('statsModalTitle').textContent = title;
            
            if (filteredAppointments.length === 0) {
                document.getElementById('statsModalContent').innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-6xl mb-4">üòî</div>
                        <p class="text-xl text-gray-400">Nenhum agendamento encontrado</p>
                    </div>
                `;
            } else {
                document.getElementById('statsModalContent').innerHTML = filteredAppointments.map(apt => {
                    const statusClass = apt.status === 'presente' ? 'bg-green-500/20 border-green-500/30' : 
                                       apt.status === 'faltou' ? 'bg-red-500/20 border-red-500/30' : 
                                       'bg-yellow-500/20 border-yellow-500/30';
                    const statusText = apt.status === 'presente' ? '‚úÖ Compareceu' : 
                                      apt.status === 'faltou' ? '‚ùå Faltou' : '‚è≥ Pendente';
                    
                    return `
                        <div class="${statusClass} rounded-xl p-4 border">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="text-gold font-bold text-lg">${apt.name}</h3>
                                    <div class="flex items-center gap-4 mt-2 text-gray-300">
                                        <span class="bg-gold/20 text-gold px-3 py-1 rounded-full text-sm">${apt.service}</span>
                                        <span>${apt.time}</span>
                                    </div>
                                    ${apt.notes ? `<p class="text-gray-400 text-sm mt-2">${apt.notes}</p>` : ''}
                                </div>
                                <span class="text-sm font-semibold">${statusText}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            document.getElementById('statsModal').classList.remove('hidden');
        }

        // Sistema de lembretes
        function checkReminders() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            const todayAppointments = appointments.filter(apt => 
                apt.date === today && apt.status === 'pendente'
            );
            
            todayAppointments.forEach(apt => {
                const [hours, minutes] = apt.time.split(':').map(Number);
                const appointmentTime = hours * 60 + minutes;
                const timeDiff = appointmentTime - currentTime;
                
                // Lembrete 30 minutos antes
                if (timeDiff <= 30 && timeDiff > 25) {
                    showReminder(apt);
                }
            });
        }

        function showReminder(appointment) {
            const reminderContent = document.getElementById('reminderContent');
            reminderContent.innerHTML = `
                <div class="font-bold mb-1">${appointment.name}</div>
                <div class="text-sm">Agendamento √†s ${appointment.time}</div>
                <div class="text-sm">Servi√ßo: ${appointment.service}</div>
                <div class="text-xs mt-2 opacity-80">Em 30 minutos</div>
            `;
            
            const notification = document.getElementById('reminderNotification');
            notification.classList.remove('hidden');
            
            // Auto-fechar ap√≥s 10 segundos
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 10000);
        }

        function startReminderSystem() {
            // Verificar lembretes a cada minuto
            reminderInterval = setInterval(checkReminders, 60000);
            // Verificar imediatamente
            checkReminders();
        }

        function stopReminderSystem() {
            if (reminderInterval) {
                clearInterval(reminderInterval);
                reminderInterval = null;
            }
        }

        // Event listeners
        loginBtn.addEventListener('click', handleEmailAuth);
        googleBtn.addEventListener('click', handleGoogleAuth);
        toggleMode.addEventListener('click', toggleAuthMode);
        clientForm.addEventListener('submit', addAppointment);
        document.getElementById('clienteForm').addEventListener('submit', addCliente);
        logoutBtn.addEventListener('click', () => signOut(auth));
        
        // Event listeners das abas
        tabAgenda.addEventListener('click', () => switchTab('agenda'));
        tabClientes.addEventListener('click', () => switchTab('clientes'));
        tabCalendar.addEventListener('click', () => switchTab('calendar'));
        tabRelatorios.addEventListener('click', () => switchTab('relatorios'));
        
        // Event listeners dos filtros
        document.getElementById('filterAll').addEventListener('click', () => setFilter('all'));
        document.getElementById('filterPendente').addEventListener('click', () => setFilter('pendente'));
        document.getElementById('filterPresente').addEventListener('click', () => setFilter('presente'));
        document.getElementById('filterFaltou').addEventListener('click', () => setFilter('faltou'));
        
        // Event listeners do calend√°rio
        prevMonth.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
        });
        
        nextMonth.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
        });

        // Enter para fazer login
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !agendaScreen.classList.contains('hidden')) {
                e.preventDefault();
            } else if (e.key === 'Enter' && !loginScreen.classList.contains('hidden')) {
                handleEmailAuth();
            }
        });

        // Event listeners para modais
        document.getElementById('closeEditModal').addEventListener('click', () => {
            document.getElementById('editModal').classList.add('hidden');
            editingAppointment = null;
        });
        
        document.getElementById('cancelEdit').addEventListener('click', () => {
            document.getElementById('editModal').classList.add('hidden');
            editingAppointment = null;
        });
        
        document.getElementById('closeStatsModal').addEventListener('click', () => {
            document.getElementById('statsModal').classList.add('hidden');
        });
        
        document.getElementById('closeReminder').addEventListener('click', () => {
            document.getElementById('reminderNotification').classList.add('hidden');
        });
        
        // Event listeners para estat√≠sticas
        document.getElementById('statsTotalBtn').addEventListener('click', () => showStatsDetails('total'));
        document.getElementById('statsPresentesBtn').addEventListener('click', () => showStatsDetails('presente'));
        document.getElementById('statsFaltaramBtn').addEventListener('click', () => showStatsDetails('faltou'));
        document.getElementById('statsPendentesBtn').addEventListener('click', () => showStatsDetails('pendente'));
        
        // Event listener para formul√°rio de edi√ß√£o
        document.getElementById('editForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!editingAppointment || !currentUser) return;
            
            try {
                const appointmentRef = doc(db, 'appointments', editingAppointment.id);
                await updateDoc(appointmentRef, {
                    name: document.getElementById('editClientName').value.trim(),
                    service: document.getElementById('editService').value.trim(),
                    date: document.getElementById('editDate').value,
                    time: document.getElementById('editTime').value,
                    notes: document.getElementById('editNotes').value.trim()
                });
                
                // Fechar modal
                document.getElementById('editModal').classList.add('hidden');
                editingAppointment = null;
                
            } catch (error) {
                console.error('Erro ao salvar edi√ß√£o:', error);
                showError('Erro ao salvar altera√ß√µes');
            }
        });

        // Event listeners para pesquisa de clientes
        document.getElementById('clientName').addEventListener('input', (e) => {
            searchClientes(e.target.value);
        });
        
        document.getElementById('clientName').addEventListener('blur', () => {
            setTimeout(() => {
                document.getElementById('clientSearchResults').classList.add('hidden');
            }, 200);
        });
        
        document.getElementById('searchClientes').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredClientes = clientes.filter(cliente => 
                cliente.nome.toLowerCase().includes(searchTerm) ||
                (cliente.telefone && cliente.telefone.includes(searchTerm)) ||
                (cliente.email && cliente.email.toLowerCase().includes(searchTerm))
            );
            renderClientes(filteredClientes);
        });

        // Monitor de autentica√ß√£o
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('userEmail').textContent = user.email;
                loginScreen.classList.add('hidden');
                agendaScreen.classList.remove('hidden');
                document.getElementById('date').valueAsDate = new Date();
                loadAppointments();
                loadClientes();
                startReminderSystem();
            } else {
                currentUser = null;
                loginScreen.classList.remove('hidden');
                agendaScreen.classList.add('hidden');
                stopReminderSystem();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'984cf073a5a52912',t:'MTc1ODgyODY1OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
